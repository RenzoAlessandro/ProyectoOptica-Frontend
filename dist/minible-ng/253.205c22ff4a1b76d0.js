(self.webpackChunkminible_ng=self.webpackChunkminible_ng||[]).push([[253],{7082:function(ht,M){!function(l){"use strict";var g="undefined"!=typeof window&&void 0!==window.flatpickr?window.flatpickr:{l10ns:{}},d={weekdays:{shorthand:["Dom","Lun","Mar","Mi\xe9","Jue","Vie","S\xe1b"],longhand:["Domingo","Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado"]},months:{shorthand:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],longhand:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]},ordinal:function(){return"\xba"},firstDayOfWeek:1,rangeSeparator:" a ",time_24hr:!0};g.l10ns.es=d;var m=g.l10ns;l.Spanish=d,l.default=m,Object.defineProperty(l,"__esModule",{value:!0})}(M)},99253:(ht,M,l)=>{"use strict";l.r(M),l.d(M,{SaleModule:()=>Be});var g=l(86019),d=l(49133),m=l(20154),w=l(40345),Zt=l(98816),ot=l(16541),it=l(41867),ft=l(5426),bt=l(63091),at=l(56225),F=l(85298),nt=l(64762),N=l(34099),rt=l(23405),st=l(22411);const vt=[{index:1,id:"#MN0123",tipo:"Montura",detalle:"ACETATO KEVIN",cantidad:"3",precio:"33.00",total:"37.00"},{index:2,id:"#MN0122",tipo:"Montura",detalle:"ACETATO BEIKUBEI",cantidad:"4",precio:"18.00",total:"86.00"},{index:3,id:"#MN0121",tipo:"Montura",detalle:"ACETATO VIPSUAL",cantidad:"2",precio:"73.90",total:"26.00"},{index:4,id:"#MN0120",tipo:"Montura",detalle:"CAREY\tCOLOR WISE",cantidad:"1",precio:"84.00",total:"83.00"},{index:5,id:"#MN0119",tipo:"Montura",detalle:"ACETATO FIORALBA",cantidad:"5",precio:"62.00",total:"38.00"}];var y=l(81366),D=l(65686),Q=l(79204),I=l(5250),t=l(83668);let lt=(()=>{class i{constructor(e){this.pipe=e,this._loading$=new N.X(!0),this._search$=new rt.xQ,this._Addsales$=new N.X([]),this._total$=new N.X(0),this._state={page:1,pageSize:10,searchTerm:"",sortColumn:"",sortDirection:""},this._search$.pipe((0,y.b)(()=>this._loading$.next(!0)),(0,D.b)(200),(0,Q.w)(()=>this._search()),(0,I.g)(200),(0,y.b)(()=>this._loading$.next(!1))).subscribe(o=>{this._Addsales$.next(o.Addsales),this._total$.next(o.total)}),this._search$.next()}get Addsales$(){return this._Addsales$.asObservable()}get total$(){return this._total$.asObservable()}get loading$(){return this._loading$.asObservable()}get page(){return this._state.page}get pageSize(){return this._state.pageSize}get searchTerm(){return this._state.searchTerm}set page(e){this._set({page:e})}set pageSize(e){this._set({pageSize:e})}set searchTerm(e){this._set({searchTerm:e})}set sortColumn(e){this._set({sortColumn:e})}set sortDirection(e){this._set({sortDirection:e})}_set(e){Object.assign(this._state,e),this._search$.next()}_search(){const{sortColumn:e,sortDirection:o,pageSize:a,page:r,searchTerm:c}=this._state;let u=function(i,n,e){return""===e||""===n?i:[...i].sort((o,a)=>{const r=((i,n)=>i<n?-1:i>n?1:0)(o[n],a[n]);return"asc"===e?r:-r})}(vt,e,o);u=u.filter(C=>function(i,n,e){return i.id.toLowerCase().includes(n)||i.detalle.toLowerCase().includes(n.toLowerCase())||i.cantidad.toLowerCase().includes(n)||i.precio.toLowerCase().includes(n)||i.total.toLowerCase().includes(n)}(C,c));const v=u.length;return u=u.slice((r-1)*a,(r-1)*a+a),(0,st.of)({Addsales:u,total:v})}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(g.JJ))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const xt={asc:"desc",desc:"","":"asc"};let qt=(()=>{class i{constructor(){this.sortable="",this.direction="",this.sort=new t.vpe}rotate(){this.direction=xt[this.direction],this.sort.emit({column:this.sortable,direction:this.direction})}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=t.lG2({type:i,selectors:[["th","sortable",""]],hostVars:4,hostBindings:function(e,o){1&e&&t.NdJ("click",function(){return o.rotate()}),2&e&&t.ekj("asc","asc"===o.direction)("desc","desc"===o.direction)},inputs:{sortable:"sortable",direction:"direction"},outputs:{sort:"sort"}}),i})();class dt{constructor(){this.list_monturas=[],this.list_lunas=[],this.list_accesorios=[],this.tipo_venta=[]}}class St{}var Nt=l(1659),T=l.n(Nt),p=l(63782),yt=l(54900),E=l.n(yt),ct=l(52653),S=l(4680),Ut=l(91917),ut=l(95686),z=l(20566),H=l(11950),mt=l(94774),R=l(48185);const Pt=["autocomplete"];function Jt(i,n){1&i&&t._UZ(0,"a",29),2&i&&t.Q6J("innerHTML",n.$implicit.id_producto,t.oJD)}function Mt(i,n){1&i&&t._UZ(0,"div",29),2&i&&t.Q6J("innerHTML",n.$implicit,t.oJD)}function wt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",30),t.TgZ(1,"form",31),t.TgZ(2,"div",32),t.TgZ(3,"ng-select",33),t.NdJ("change",function(){return t.CHM(e),t.oxw().changeSede()}),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("formGroup",e.formSedes),t.xp6(2),t.s9C("formControlName",e.nombre_sedes),t.Q6J("items",e.listSedes)}}function Et(i,n){if(1&i&&(t.TgZ(0,"td"),t._UZ(1,"ngb-highlight",34),t._uU(2,"\xa0 "),t._UZ(3,"ngb-highlight",34),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("result",e.material),t.xp6(2),t.Q6J("result",e.marca)}}function zt(i,n){if(1&i&&(t.TgZ(0,"td"),t._UZ(1,"ngb-highlight",34),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("result",e.material)}}function Vt(i,n){if(1&i&&(t.TgZ(0,"td"),t._UZ(1,"ngb-highlight",34),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("result",e.nombre_accesorio)}}function Lt(i,n){if(1&i&&(t.TgZ(0,"td"),t._UZ(1,"ngb-highlight",34),t.ALo(2,"currency"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("result",t.xi3(2,1,e.precio_montura_v,"S/ "))}}function kt(i,n){if(1&i&&(t.TgZ(0,"td"),t._UZ(1,"ngb-highlight",34),t.ALo(2,"currency"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("result",t.xi3(2,1,e.precio_luna_v,"S/ "))}}function Ft(i,n){if(1&i&&(t.TgZ(0,"td"),t._UZ(1,"ngb-highlight",34),t.ALo(2,"currency"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("result",t.xi3(2,1,e.precio_accesorio_v,"S/ "))}}function Dt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td"),t._UZ(2,"ngb-highlight",34),t.qZA(),t.TgZ(3,"td"),t._UZ(4,"ngb-highlight",34),t.qZA(),t.YNc(5,Et,4,2,"td",35),t.YNc(6,zt,2,1,"td",35),t.YNc(7,Vt,2,1,"td",35),t.TgZ(8,"td"),t._UZ(9,"ngb-highlight",34),t.qZA(),t.YNc(10,Lt,3,4,"td",35),t.YNc(11,kt,3,4,"td",35),t.YNc(12,Ft,3,4,"td",35),t.TgZ(13,"td"),t._UZ(14,"ngb-highlight",34),t.ALo(15,"currency"),t.qZA(),t.TgZ(16,"td"),t.TgZ(17,"a",36),t.TgZ(18,"i",37),t.NdJ("click",function(a){const c=t.CHM(e).index;return t.oxw().substractQuantityProduct(a,c)}),t.qZA(),t.qZA(),t.TgZ(19,"a",38),t.TgZ(20,"i",39),t.NdJ("ngModelChange",function(a){return t.CHM(e).$implicit.num=a})("click",function(a){const c=t.CHM(e).index;return t.oxw().addQuantityProduct(a,c)}),t.qZA(),t.qZA(),t.TgZ(21,"a",40),t.NdJ("click",function(){const r=t.CHM(e).$implicit,c=t.oxw(),u=t.MAs(50);return c.centerModalEditarPrecio(u,r)}),t._UZ(22,"i",41),t.qZA(),t.TgZ(23,"a",42),t.TgZ(24,"i",43),t.NdJ("click",function(a){const c=t.CHM(e).index;return t.oxw().removeCartProduct(a,c)}),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=n.$implicit,o=n.index;t.xp6(2),t.Q6J("result",o+1),t.xp6(2),t.Q6J("result",e.tipo),t.xp6(1),t.Q6J("ngIf","montura"==e.tipo),t.xp6(1),t.Q6J("ngIf","luna"==e.tipo),t.xp6(1),t.Q6J("ngIf","accesorio"==e.tipo),t.xp6(2),t.Q6J("result",e.cant_vendida),t.xp6(1),t.Q6J("ngIf","montura"==e.tipo),t.xp6(1),t.Q6J("ngIf","luna"==e.tipo),t.xp6(1),t.Q6J("ngIf","accesorio"==e.tipo),t.xp6(2),t.Q6J("result",t.xi3(15,11,e.precio,"S/ ")),t.xp6(6),t.Q6J("ngModel",e.num)}}function Qt(i,n){1&i&&(t.TgZ(0,"div"),t._uU(1," Campo requerido "),t.qZA())}function It(i,n){1&i&&(t.TgZ(0,"div"),t._uU(1," Ingrese solo n\xfameros "),t.qZA())}const x=function(i){return{"is-invalid":i}};function Ht(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",44),t.TgZ(1,"h5",45),t._uU(2,"Cambio de Precio"),t.qZA(),t.TgZ(3,"button",46),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeEventModal()}),t.qZA(),t.qZA(),t.TgZ(4,"form",31),t.TgZ(5,"div",47),t.TgZ(6,"div",13),t.TgZ(7,"div",48),t.TgZ(8,"label",49),t._uU(9,"Precio Original"),t.qZA(),t._UZ(10,"input",50),t.qZA(),t.TgZ(11,"div",48),t.TgZ(12,"div",51),t.TgZ(13,"label",52),t._uU(14,"Nuevo Precio de Venta"),t.qZA(),t._UZ(15,"input",53),t.TgZ(16,"div",54),t.YNc(17,Qt,2,0,"div",35),t.YNc(18,It,2,0,"div",35),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(19,"div",55),t.TgZ(20,"button",56),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeEventModal()}),t._uU(21," Cerrar "),t.qZA(),t.TgZ(22,"button",57),t.NdJ("click",function(){return t.CHM(e),t.oxw().actualizarPrecio()}),t._uU(23," Guardar "),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(4),t.Q6J("formGroup",e.formEditarPrecio),t.xp6(6),t.s9C("formControlName",e.precioOriginal_Editar),t.xp6(5),t.s9C("formControlName",e.nuevoPrecio_Editar),t.Q6J("ngClass",t.VKq(6,x,e.formEP.campoNuevoPrecioEditar.invalid&&(e.formEP.campoNuevoPrecioEditar.dirty||e.formEP.campoNuevoPrecioEditar.touched))),t.xp6(2),t.Q6J("ngIf",null==e.formEP.campoNuevoPrecioEditar.errors?null:e.formEP.campoNuevoPrecioEditar.errors.required),t.xp6(1),t.Q6J("ngIf",null==e.formEP.campoNuevoPrecioEditar.errors?null:e.formEP.campoNuevoPrecioEditar.errors.pattern)}}function Rt(i,n){1&i&&(t.TgZ(0,"div",91),t._uU(1," Campo requerido "),t.qZA())}function Ot(i,n){1&i&&(t.TgZ(0,"div",91),t._uU(1," Ingrese como m\xe1ximo 2 decimales "),t.qZA())}function Bt(i,n){if(1&i&&(t.TgZ(0,"div",91),t.YNc(1,Rt,2,0,"div",77),t.YNc(2,Ot,2,0,"div",77),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.formContado.controls.campoCantidadRecibidaContado.errors.required),t.xp6(1),t.Q6J("ngIf",e.formContado.controls.campoCantidadRecibidaContado.errors.pattern)}}function Yt(i,n){1&i&&(t.TgZ(0,"div",91),t._uU(1," Campo requerido "),t.qZA())}function $t(i,n){if(1&i&&(t.TgZ(0,"div",91),t.YNc(1,Yt,2,0,"div",77),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.formContado.controls.campoMetodoPagoContado.errors.required)}}function Gt(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"This value is required."),t.qZA())}function jt(i,n){if(1&i&&(t.TgZ(0,"div",54),t.YNc(1,Gt,2,0,"span",35),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.form.title.errors.required)}}function Kt(i,n){1&i&&t._UZ(0,"a",29),2&i&&t.Q6J("innerHTML",n.$implicit.nombres_apellidos,t.oJD)}function Xt(i,n){1&i&&t._UZ(0,"div",29),2&i&&t.Q6J("innerHTML",n.$implicit,t.oJD)}function Wt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"form",71),t.NdJ("ngSubmit",function(){return t.CHM(e),t.oxw(2).saveEvent()}),t.TgZ(1,"div",72),t.TgZ(2,"div",73),t.TgZ(3,"div",74),t.TgZ(4,"label",75),t._uU(5,"Cantidad Recibida"),t.qZA(),t.TgZ(6,"input",76),t.NdJ("change",function(a){return t.CHM(e),t.oxw(2).updatePago(a)}),t.qZA(),t.YNc(7,Bt,3,2,"div",77),t.qZA(),t.qZA(),t.TgZ(8,"div",73),t.TgZ(9,"div",74),t.TgZ(10,"label",78),t._uU(11,"M\xe9todo"),t.qZA(),t._UZ(12,"ng-select",79),t.YNc(13,$t,2,1,"div",77),t.qZA(),t.qZA(),t.TgZ(14,"div",73),t.TgZ(15,"div",74),t.TgZ(16,"label",75),t._uU(17,"Fecha"),t.qZA(),t._UZ(18,"input",80),t.YNc(19,jt,2,1,"div",81),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"div",13),t.TgZ(21,"div",82),t.TgZ(22,"div",74),t.TgZ(23,"label",75),t._uU(24,"Buscar Cliente"),t.qZA(),t.TgZ(25,"ng-autocomplete",83),t.NdJ("selected",function(a){return t.CHM(e),t.oxw(2).selectEventCliente(a)}),t.qZA(),t.YNc(26,Kt,1,1,"ng-template",null,84,t.W1O),t.YNc(28,Xt,1,1,"ng-template",null,8,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.TgZ(30,"div",13),t.TgZ(31,"div",82),t.TgZ(32,"label",85),t._uU(33,"Montos:"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(34,"div",13),t.TgZ(35,"div",73),t.TgZ(36,"div",74),t.TgZ(37,"label",75),t._uU(38,"Total"),t.qZA(),t._UZ(39,"input",86),t.qZA(),t.qZA(),t.TgZ(40,"div",73),t.TgZ(41,"div",74),t.TgZ(42,"label",75),t._uU(43,"Pago"),t.qZA(),t._UZ(44,"input",87),t.qZA(),t.qZA(),t.TgZ(45,"div",73),t.TgZ(46,"div",74),t.TgZ(47,"label",75),t._uU(48,"Cambio"),t.qZA(),t._UZ(49,"input",88),t.qZA(),t.qZA(),t.qZA(),t.TgZ(50,"div",13),t.TgZ(51,"div",14),t.TgZ(52,"div",51),t.TgZ(53,"label",89),t._uU(54,"Observaciones"),t.qZA(),t._UZ(55,"textarea",90),t.qZA(),t.qZA(),t.qZA(),t.TgZ(56,"div",23),t.TgZ(57,"button",56),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).closeEventModal()}),t._uU(58," Cerrar "),t.qZA(),t.TgZ(59,"button",24),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).guardarVenta()}),t._uU(60," Registrar Venta "),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.MAs(27),o=t.MAs(29),a=t.oxw(2);t.Q6J("formGroup",a.formContado),t.xp6(6),t.s9C("formControlName",a.cantidadRecibida_Contado),t.xp6(1),t.Q6J("ngIf",a.formContado.controls.campoCantidadRecibidaContado.invalid&&(a.formContado.controls.campoCantidadRecibidaContado.dirty||a.formContado.controls.campoCantidadRecibidaContado.touched)),t.xp6(5),t.s9C("formControlName",a.metodoPagoContado),t.Q6J("items",a.listMetodosPagos),t.xp6(1),t.Q6J("ngIf",a.formContado.controls.campoMetodoPagoContado.invalid&&(a.formContado.controls.campoMetodoPagoContado.dirty||a.formContado.controls.campoMetodoPagoContado.touched)),t.xp6(5),t.s9C("formControlName",a.fechaVenta_Contado),t.Q6J("ngClass",t.VKq(22,x,a.submitted&&a.form.title.errors)),t.xp6(1),t.Q6J("ngIf",a.submitted&&a.form.title.errors),t.xp6(6),t.s9C("formControlName",a.nombreContado),t.Q6J("data",a.listClients)("searchKeyword",a.keywordCliente)("itemTemplate",e)("notFoundTemplate",o),t.xp6(14),t.s9C("formControlName",a.precioTotal_Contado),t.Q6J("ngClass",t.VKq(24,x,a.submitted&&a.form.title.errors)),t.xp6(5),t.s9C("formControlName",a.pago_Contado),t.Q6J("ngClass",t.VKq(26,x,a.submitted&&a.form.title.errors)),t.xp6(5),t.s9C("formControlName",a.cambio_Contado),t.Q6J("ngClass",t.VKq(28,x,a.submitted&&a.form.title.errors)),t.xp6(6),t.s9C("formControlName",a.observaciones_Contado),t.xp6(4),t.Q6J("disabled",!a.formContado.valid)}}function te(i,n){1&i&&(t.TgZ(0,"div",91),t._uU(1," Campo requerido "),t.qZA())}function ee(i,n){1&i&&(t.TgZ(0,"div",91),t._uU(1," Ingrese como m\xe1ximo 2 decimales "),t.qZA())}function oe(i,n){if(1&i&&(t.TgZ(0,"div",91),t.YNc(1,te,2,0,"div",77),t.YNc(2,ee,2,0,"div",77),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.formCredito.controls.campoCantidadRecibidaCredito.errors.required),t.xp6(1),t.Q6J("ngIf",e.formCredito.controls.campoCantidadRecibidaCredito.errors.pattern)}}function ie(i,n){1&i&&(t.TgZ(0,"div",91),t._uU(1," Campo requerido "),t.qZA())}function ae(i,n){if(1&i&&(t.TgZ(0,"div",91),t.YNc(1,ie,2,0,"div",77),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.formCredito.controls.campoMetodoPagoCredito.errors.required)}}function ne(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"This value is required."),t.qZA())}function re(i,n){if(1&i&&(t.TgZ(0,"div",54),t.YNc(1,ne,2,0,"span",35),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.form.title.errors.required)}}function se(i,n){1&i&&t._UZ(0,"a",29),2&i&&t.Q6J("innerHTML",n.$implicit.nombres_apellidos,t.oJD)}function le(i,n){1&i&&t._UZ(0,"div",29),2&i&&t.Q6J("innerHTML",n.$implicit,t.oJD)}function de(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"form",71),t.NdJ("ngSubmit",function(){return t.CHM(e),t.oxw(2).saveEvent()}),t.TgZ(1,"div",72),t.TgZ(2,"div",73),t.TgZ(3,"div",74),t.TgZ(4,"label",75),t._uU(5,"Cantidad Recibida"),t.qZA(),t.TgZ(6,"input",92),t.NdJ("change",function(a){return t.CHM(e),t.oxw(2).updatePago(a)}),t.qZA(),t.YNc(7,oe,3,2,"div",77),t.qZA(),t.qZA(),t.TgZ(8,"div",73),t.TgZ(9,"div",74),t.TgZ(10,"label",78),t._uU(11,"M\xe9todo"),t.qZA(),t._UZ(12,"ng-select",79),t.YNc(13,ae,2,1,"div",77),t.qZA(),t.qZA(),t.TgZ(14,"div",73),t.TgZ(15,"div",74),t.TgZ(16,"label",75),t._uU(17,"Fecha"),t.qZA(),t._UZ(18,"input",93),t.YNc(19,re,2,1,"div",81),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"div",13),t.TgZ(21,"div",82),t.TgZ(22,"div",74),t.TgZ(23,"label",75),t._uU(24,"N\xfamero de Cuotas"),t.qZA(),t.TgZ(25,"div",94),t.TgZ(26,"ng5-slider",95),t.NdJ("valueChange",function(a){return t.CHM(e),t.oxw(2).tickValue=a}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(27,"div",13),t.TgZ(28,"div",82),t.TgZ(29,"div",74),t.TgZ(30,"label",75),t._uU(31,"Buscar o Crear nuevo Cliente"),t.qZA(),t.TgZ(32,"ng-autocomplete",96),t.NdJ("selected",function(a){return t.CHM(e),t.oxw(2).selectEventCliente(a)}),t.qZA(),t.YNc(33,se,1,1,"ng-template",null,97,t.W1O),t.YNc(35,le,1,1,"ng-template",null,8,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.TgZ(37,"div",13),t.TgZ(38,"div",82),t.TgZ(39,"label",85),t._uU(40,"Montos:"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(41,"div",13),t.TgZ(42,"div",73),t.TgZ(43,"div",74),t.TgZ(44,"label",75),t._uU(45,"Total"),t.qZA(),t._UZ(46,"input",98),t.qZA(),t.qZA(),t.TgZ(47,"div",73),t.TgZ(48,"div",74),t.TgZ(49,"label",75),t._uU(50,"Pago"),t.qZA(),t._UZ(51,"input",99),t.qZA(),t.qZA(),t.TgZ(52,"div",73),t.TgZ(53,"div",74),t.TgZ(54,"label",75),t._uU(55,"Deuda"),t.qZA(),t._UZ(56,"input",100),t.qZA(),t.qZA(),t.qZA(),t.TgZ(57,"div",13),t.TgZ(58,"div",14),t.TgZ(59,"div",51),t.TgZ(60,"label",89),t._uU(61,"Observaciones"),t.qZA(),t._UZ(62,"textarea",90),t.qZA(),t.qZA(),t.qZA(),t.TgZ(63,"div",23),t.TgZ(64,"button",56),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).closeEventModal()}),t._uU(65," Cerrar "),t.qZA(),t.TgZ(66,"button",24),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).guardarVenta()}),t._uU(67," Registrar Venta "),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.MAs(34),o=t.MAs(36),a=t.oxw(2);t.Q6J("formGroup",a.formCredito),t.xp6(6),t.s9C("formControlName",a.cantidadRecibida_Credito),t.xp6(1),t.Q6J("ngIf",a.formCredito.controls.campoCantidadRecibidaCredito.invalid&&(a.formCredito.controls.campoCantidadRecibidaCredito.dirty||a.formCredito.controls.campoCantidadRecibidaCredito.touched)),t.xp6(5),t.s9C("formControlName",a.metodoPagoCredito),t.Q6J("items",a.listMetodosPagos),t.xp6(1),t.Q6J("ngIf",a.formCredito.controls.campoMetodoPagoCredito.invalid&&(a.formCredito.controls.campoMetodoPagoCredito.dirty||a.formCredito.controls.campoMetodoPagoCredito.touched)),t.xp6(5),t.s9C("formControlName",a.fechaVenta_Credito),t.Q6J("ngClass",t.VKq(24,x,a.submitted&&a.form.title.errors)),t.xp6(1),t.Q6J("ngIf",a.submitted&&a.form.title.errors),t.xp6(7),t.Q6J("value",a.tickValue)("options",a.tickValueoptions),t.xp6(6),t.s9C("formControlName",a.nombreCredito),t.Q6J("data",a.listClients)("searchKeyword",a.keywordCliente)("itemTemplate",e)("notFoundTemplate",o),t.xp6(14),t.s9C("formControlName",a.precioTotal_Credito),t.Q6J("ngClass",t.VKq(26,x,a.submitted&&a.form.title.errors)),t.xp6(5),t.s9C("formControlName",a.pago_Credito),t.Q6J("ngClass",t.VKq(28,x,a.submitted&&a.form.title.errors)),t.xp6(5),t.s9C("formControlName",a.cambio_Credito),t.Q6J("ngClass",t.VKq(30,x,a.submitted&&a.form.title.errors)),t.xp6(6),t.s9C("formControlName",a.observaciones_Credito),t.xp6(4),t.Q6J("disabled",!a.formCredito.valid)}}function ce(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",44),t.TgZ(1,"h5",58),t._uU(2,"Registrar Venta"),t.qZA(),t.TgZ(3,"button",46),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeEventModal()}),t.qZA(),t.qZA(),t.TgZ(4,"div",59),t.TgZ(5,"div",60),t.TgZ(6,"ul",61,62),t.NdJ("navChange",function(a){return t.CHM(e),t.oxw().selectorMetodoPago(a)}),t.TgZ(8,"li",63),t.TgZ(9,"a",64),t.TgZ(10,"span",65),t._UZ(11,"i",66),t.qZA(),t.TgZ(12,"span",67),t._uU(13,"Al Contado"),t.qZA(),t.qZA(),t.YNc(14,Wt,61,30,"ng-template",68),t.qZA(),t.TgZ(15,"li",63),t.TgZ(16,"a",64),t.TgZ(17,"span",65),t._UZ(18,"i",69),t.qZA(),t.TgZ(19,"span",67),t._uU(20,"Al Cr\xe9dito"),t.qZA(),t.qZA(),t.YNc(21,de,68,32,"ng-template",68),t.qZA(),t.qZA(),t._UZ(22,"div",70),t.qZA(),t.qZA()}if(2&i){const e=t.MAs(7),o=t.oxw();t.xp6(6),t.Q6J("activeId",o.activePago),t.xp6(2),t.Q6J("ngbNavItem",1),t.xp6(7),t.Q6J("ngbNavItem",2),t.xp6(7),t.Q6J("ngbNavOutlet",e)}}function ue(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",44),t.TgZ(1,"h5",45),t._uU(2,"Factura de Venta"),t.qZA(),t.TgZ(3,"button",101),t.NdJ("click",function(){return t.CHM(e).$implicit.dismiss("Cross click")}),t.qZA(),t.qZA(),t.TgZ(4,"div",47),t.TgZ(5,"div",13),t.TgZ(6,"div",14),t.TgZ(7,"div",15),t.TgZ(8,"div",16),t.TgZ(9,"div",102),t.TgZ(10,"h4",103),t._uU(11,"Factura #MN0131 "),t.TgZ(12,"span",104),t._uU(13,"Paid"),t.qZA(),t.qZA(),t.TgZ(14,"div",51),t._UZ(15,"img",105),t.qZA(),t.TgZ(16,"div",106),t.TgZ(17,"p",107),t._UZ(18,"i",108),t._uU(19,"641 Counts Lane Wilmore, KY 40390"),t.qZA(),t.TgZ(20,"p",107),t._UZ(21,"i",109),t._uU(22," abc@123.com"),t.qZA(),t.TgZ(23,"p"),t._UZ(24,"i",110),t._uU(25," 012-345-6789"),t.qZA(),t.qZA(),t.qZA(),t._UZ(26,"hr",111),t.TgZ(27,"div",13),t.TgZ(28,"div",48),t.TgZ(29,"div",106),t.TgZ(30,"h5",112),t._uU(31,"Facturado a:"),t.qZA(),t.TgZ(32,"h5",113),t._uU(33,"Preston Miller"),t.qZA(),t.TgZ(34,"p",107),t._uU(35,"4450 Fancher Drive Dallas, TX 75247"),t.qZA(),t.TgZ(36,"p",107),t._uU(37,"PrestonMiller@armyspy.com"),t.qZA(),t.TgZ(38,"p"),t._uU(39,"001-234-5678"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(40,"div",48),t.TgZ(41,"div",114),t.TgZ(42,"div"),t.TgZ(43,"h5",115),t._uU(44,"N\xba de Factura:"),t.qZA(),t.TgZ(45,"p"),t._uU(46,"#MN0131"),t.qZA(),t.qZA(),t.TgZ(47,"div",116),t.TgZ(48,"h5",115),t._uU(49,"Fecha de la Factura:"),t.qZA(),t.TgZ(50,"p"),t._uU(51,"09 Jul, 2020"),t.qZA(),t.qZA(),t.TgZ(52,"div",116),t.TgZ(53,"h5",115),t._uU(54,"N\xba de pedido:"),t.qZA(),t.TgZ(55,"p"),t._uU(56,"#1123456"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(57,"div",117),t.TgZ(58,"h5",118),t._uU(59,"Resumen del Pedido"),t.qZA(),t.TgZ(60,"div",18),t.TgZ(61,"table",119),t.TgZ(62,"thead"),t.TgZ(63,"tr"),t.TgZ(64,"th",120),t._uU(65,"No."),t.qZA(),t.TgZ(66,"th"),t._uU(67,"Detalle"),t.qZA(),t.TgZ(68,"th"),t._uU(69,"Precio"),t.qZA(),t.TgZ(70,"th"),t._uU(71,"Cantidad"),t.qZA(),t.TgZ(72,"th",121),t._uU(73,"Total"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(74,"tbody"),t.TgZ(75,"tr"),t.TgZ(76,"th",122),t._uU(77,"01"),t.qZA(),t.TgZ(78,"td"),t.TgZ(79,"h5",123),t._uU(80,"Nike N012 Running Shoes"),t.qZA(),t.TgZ(81,"ul",124),t.TgZ(82,"li",125),t._uU(83,"Color : "),t.TgZ(84,"span",126),t._uU(85,"Gray"),t.qZA(),t.qZA(),t.TgZ(86,"li",125),t._uU(87,"Size : "),t.TgZ(88,"span",126),t._uU(89,"08"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(90,"td"),t._uU(91,"$260"),t.qZA(),t.TgZ(92,"td"),t._uU(93,"1"),t.qZA(),t.TgZ(94,"td",127),t._uU(95,"PEN 260.00"),t.qZA(),t.qZA(),t.TgZ(96,"tr"),t.TgZ(97,"th",122),t._uU(98,"02"),t.qZA(),t.TgZ(99,"td"),t.TgZ(100,"h5",123),t._uU(101,"Adidas Running Shoes"),t.qZA(),t.TgZ(102,"ul",124),t.TgZ(103,"li",125),t._uU(104,"Color : "),t.TgZ(105,"span",126),t._uU(106,"Black"),t.qZA(),t.qZA(),t.TgZ(107,"li",125),t._uU(108,"Size : "),t.TgZ(109,"span",126),t._uU(110,"09"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(111,"td"),t._uU(112,"$250"),t.qZA(),t.TgZ(113,"td"),t._uU(114,"1"),t.qZA(),t.TgZ(115,"td",127),t._uU(116,"PEN 250.00"),t.qZA(),t.qZA(),t.TgZ(117,"tr"),t.TgZ(118,"th",128),t._uU(119,"Sub Total"),t.qZA(),t.TgZ(120,"td",127),t._uU(121,"PEN 510.00"),t.qZA(),t.qZA(),t.TgZ(122,"tr"),t.TgZ(123,"th",129),t._uU(124," Descuento :"),t.qZA(),t.TgZ(125,"td",130),t._uU(126,"- PEN 50.00"),t.qZA(),t.qZA(),t.TgZ(127,"tr"),t.TgZ(128,"th",129),t._uU(129," Costo de env\xedo :"),t.qZA(),t.TgZ(130,"td",130),t._uU(131,"PEN 25.00"),t.qZA(),t.qZA(),t.TgZ(132,"tr"),t.TgZ(133,"th",129),t._uU(134," Impuesto (IGV)"),t.qZA(),t.TgZ(135,"td",130),t._uU(136,"PEN 13.00"),t.qZA(),t.qZA(),t.TgZ(137,"tr"),t.TgZ(138,"th",129),t._uU(139,"Total"),t.qZA(),t.TgZ(140,"td",130),t.TgZ(141,"h4",131),t._uU(142,"PEN 498.00"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(143,"div",55),t.TgZ(144,"a",132),t._UZ(145,"i",133),t.qZA(),t.TgZ(146,"a",134),t._UZ(147,"i",135),t.qZA(),t.TgZ(148,"button",136),t.NdJ("click",function(){return t.CHM(e).$implicit.close("Close click")}),t._uU(149,"Cerrar"),t.qZA(),t.TgZ(150,"button",137),t._uU(151,"Guardar cambios"),t.qZA(),t.qZA()}}E().vfs=ct.I.vfs;let me=(()=>{class i{constructor(e,o,a,r,c,u){this.service=e,this.fb=o,this.modalService=a,this.productosService=r,this.customerService=c,this.usuarioService=u,this.role="Admin",this.nombre_sedes="campoSede",this.idSede="",this.submitted_Contado=!1,this.cantidadRecibida_Contado="campoCantidadRecibidaContado",this.fechaVenta_Contado="campoFechaVentaContado",this.usuario_Contado="campoUsuarioContado",this.nombreContado="campoNombreContado",this.precioTotal_Contado="campoPrecioTotalContado",this.pago_Contado="campoPagoContado",this.cambio_Contado="campoCambioContado",this.observaciones_Contado="campoObservacionesContado",this.metodoPagoContado="campoMetodoPagoContado",this.cantidadRecibida_Credito="campoCantidadRecibidaCredito",this.fechaVenta_Credito="campoFechaVentaCredito",this.usuario_Credito="campoUsuarioCredito",this.nombreCredito="campoNombreCredito",this.precioTotal_Credito="campoPrecioTotalCredito",this.pago_Credito="campoPagoCredito",this.cambio_Credito="campoCambioCredito",this.observaciones_Credito="campoObservacionesCredito",this.metodoPagoCredito="campoMetodoPagoCredito",this.submitted_EditarPrecio=!1,this.precioOriginal_Editar="campoPrecioOriginalEditar",this.nuevoPrecio_Editar="campoNuevoPrecioEditar",this.listAllProducts=[],this.active=1,this.keyword="id_producto",this.keywordCliente="nombres_apellidos",this.products=[],this.venta=new dt,this.tipoPago=new St,this.activePago=1,this.selectorPago="contado",this.listMetodosPagos=["F\xedsico","Yape","Plin","Interbancario"],this.listClients=[],this.btnGuardar=!1,this.numberPattern="(^[0-9])+([.][0-9]{1,2})?$",this.decimalPattern=/^\d+(\.\d{1,2})?$/,this.tickValue=2,this.tickValueoptions={showTicksValues:!0,stepsArray:[{value:2,legend:"M\xednimo"},{value:3},{value:4},{value:5,legend:"M\xe1ximo"}]},this.addsales$=e.Addsales$,this.total$=e.total$}ngOnInit(){this.breadCrumbItems=[{label:"Venta"},{label:"Realizar Venta",active:!0}],this.getListSedes(),this.getListMonturas(this.usuarioService.getSedebyUser()),this.crearFormularioEditarPrecio()}getListSedes(){this.listSedes=JSON.parse(localStorage.getItem("sedes")),this.idSede=this.usuarioService.getSedebyUser()}crearFormularioEditarPrecio(){this.formEditarPrecio=this.fb.group({[this.precioOriginal_Editar]:[{value:"S/ 000.00",disabled:!0}],[this.nuevoPrecio_Editar]:[null,[d.kI.required,d.kI.pattern(this.decimalPattern)]]}),this.formSedes=this.fb.group({[this.nombre_sedes]:[this.idSede]})}fS(e){return this.formSedes.get(e)}changeSede(){this.idSede=this.fS(this.nombre_sedes).value,this.updateProductosbySede(this.idSede)}updateProductosbySede(e){this.listAllProducts=[],this.products=[],this.getListMonturas(e)}fE(e){return this.formEditarPrecio.get(e)}crearFormulario(){this.formContado=this.fb.group({[this.cantidadRecibida_Contado]:[null,[d.kI.required,d.kI.pattern(this.decimalPattern)]],[this.fechaVenta_Contado]:[{value:null,disabled:!0}],[this.usuario_Contado]:[null],[this.precioTotal_Contado]:[{value:null,disabled:!0}],[this.pago_Contado]:[{value:null,disabled:!0}],[this.cambio_Contado]:[{value:null,disabled:!0}],[this.observaciones_Contado]:[null],[this.metodoPagoContado]:[null,[d.kI.required]],[this.nombreContado]:[null,[d.kI.required]]}),this.formCredito=this.fb.group({[this.cantidadRecibida_Credito]:[null,[d.kI.required,d.kI.pattern(this.decimalPattern)]],[this.fechaVenta_Credito]:[{value:null,disabled:!0}],[this.usuario_Credito]:[null],[this.precioTotal_Credito]:[{value:null,disabled:!0}],[this.pago_Credito]:[{value:null,disabled:!0}],[this.cambio_Credito]:[{value:null,disabled:!0}],[this.observaciones_Credito]:[null],[this.metodoPagoCredito]:[null,[d.kI.required]],[this.nombreCredito]:[null,[d.kI.required]]})}onSort({column:e,direction:o}){this.headers.forEach(a=>{a.sortable!==e&&(a.direction="")}),this.service.sortColumn=e,this.service.sortDirection=o}centerModal(e,o){this.crearFormulario(),this.getListClients(),this.fechaVenta=new Date(Date.now()),this.modalService.open(e,{centered:!0,windowClass:"modal-holder"}),this.f(this.fechaVenta_Contado).setValue(this.fechaVenta.toLocaleDateString()),this.f(this.precioTotal_Contado).setValue(this.precioTotalVenta.toFixed(2)),this.g(this.fechaVenta_Credito).setValue(this.fechaVenta.toLocaleDateString()),this.g(this.precioTotal_Credito).setValue(this.precioTotalVenta.toFixed(2))}scrollModal(e){this.modalService.open(e,{size:"xl",scrollable:!0})}centerModalEditarPrecio(e,o){switch(this.formEditarPrecio.reset(),this.tmpProducto=o,o.tipo){case"montura":this.fE(this.precioOriginal_Editar).setValue(o.precio_montura_v);break;case"accesorio":this.fE(this.precioOriginal_Editar).setValue(o.precio_accesorio_v);break;case"luna":this.fE(this.precioOriginal_Editar).setValue(o.precio_luna_v)}this.modalService.open(e,{scrollable:!0,size:"md",windowClass:"modal-holder",centered:!0})}actualizarPrecio(){let e=Number(this.fE(this.nuevoPrecio_Editar).value);switch(this.tmpProducto.tipo){case"montura":this.products.forEach(o=>{o.id_producto==this.tmpProducto.id_producto&&(o.precio_montura_v=isNaN(e)?0:e,o.precio=o.precio_montura_v*o.cant_vendida)});break;case"accesorio":this.products.forEach(o=>{o.id_producto==this.tmpProducto.id_producto&&(o.precio_accesorio_v=isNaN(e)?0:e,o.precio=o.precio_accesorio_v*o.cant_vendida)});break;case"luna":this.products.forEach(o=>{o.id_producto==this.tmpProducto.id_producto&&(o.precio_luna_v=isNaN(e)?0:e,o.precio=o.precio_luna_v*o.cant_vendida)})}this.modalService.dismissAll()}deleteEventData(){this.editEvent.remove(),this.modalService.dismissAll()}closeEventModal(){this.modalService.dismissAll()}saveEvent(){this.submitted_Contado=!0}getListMonturas(e){(0,p.H)("loading","Cargando..."),this.productosService.getMonturasforSale(e).subscribe(o=>{this.listAllProducts=o,this.getListAccesorios(e)})}getListAccesorios(e){this.productosService.getAccesoriosforSale(e).subscribe(o=>{this.listAllProducts=[...o,...this.listAllProducts],this.getListLunas(e)})}getListLunas(e){this.productosService.getLunasforSale(e).subscribe(o=>{this.listAllProducts=[...o,...this.listAllProducts],(0,p.H)("close",null)})}getListClients(){this.customerService.getAllClientsforSale().subscribe(e=>{this.listClients=e,this.listClients.forEach(o=>{o.nombres_apellidos=o.apellidos+" "+o.nombres})})}selectorMetodoPago(e){this.selectorPago=1==e.nextId?"contado":"credito"}selectEvent(e){const o=this.products.find(a=>a.id_producto===e.id_producto);if(o){if(o.cant_vendida+1>o.cantidad)return(0,p.H)("error","No se puede agregar m\xe1s productos del stock"),void this.autocomplete.clear();o.cant_vendida+=1,this.autocomplete.clear()}else{switch(e.tipo){case"montura":this.products.push(Object.assign(Object.assign({},e),{cant_vendida:1,precio:e.precio_montura_v})),this.autocomplete.clear();break;case"luna":this.products.push(Object.assign(Object.assign({},e),{cant_vendida:1,precio:e.precio_luna_v})),this.autocomplete.clear();break;case"accesorio":this.products.push(Object.assign(Object.assign({},e),{cant_vendida:1,precio:e.precio_accesorio_v})),this.autocomplete.clear()}this.estadoBotonGuardar()}}selectEventCliente(e){this.customer=e,"contado"==this.selectorPago?this.f(this.usuario_Contado).setValue(e.id_cliente):this.g(this.usuario_Credito).setValue(e.id_cliente),this.venta.nombre_cliente=e.nombres+" "+e.apellidos}onChangeSearch(e){}onFocused(e){}getTotalCost(){return this.precioTotalVenta=this.products.map(e=>e.precio).reduce((e,o)=>e+o,0),this.precioTotalVenta=(0,S.NM)(this.precioTotalVenta,1),this.precioTotalVenta}addQuantityProduct(e,o){if(this.products[o].cant_vendida+1>this.products[o].cantidad)(0,p.H)("error","No se puede agregar m\xe1s productos del stock");else switch(this.products[o].cant_vendida+=1,this.products[o].tipo){case"montura":this.products[o].precio=this.products[o].precio_montura_v*this.products[o].cant_vendida;break;case"luna":this.products[o].precio=this.products[o].precio_luna_v*this.products[o].cant_vendida;break;case"accesorio":this.products[o].precio=this.products[o].precio_accesorio_v*this.products[o].cant_vendida}}substractQuantityProduct(e,o){switch(this.products[o].cant_vendida-=1,this.products[o].tipo){case"montura":this.products[o].precio=this.products[o].precio_montura_v*this.products[o].cant_vendida;break;case"luna":this.products[o].precio=this.products[o].precio_luna_v*this.products[o].cant_vendida;break;case"accesorio":this.products[o].precio=this.products[o].precio_accesorio_v*this.products[o].cant_vendida}0===this.products[o].cant_vendida&&this.removeProduct()}removeProduct(){this.products=this.products.filter(e=>0!==e.cant_vendida)}removeCartProduct(e,o){this.products[o].cant_vendida=0,this.removeProduct(),this.estadoBotonGuardar()}estadoBotonGuardar(){this.btnGuardar=0!=this.products.length}get formEP(){return this.formEditarPrecio.controls}f(e){return this.formContado.get(e)}g(e){return this.formCredito.get(e)}updatePago(e){if("contado"==this.selectorPago)this.f(this.pago_Contado).setValue(this.f(this.cantidadRecibida_Contado).value),this.f(this.cambio_Contado).setValue((this.f(this.cantidadRecibida_Contado).value-this.precioTotalVenta).toFixed(2));else{const o=Number((this.g(this.cantidadRecibida_Credito).value-this.precioTotalVenta).toFixed(2));this.g(this.pago_Credito).setValue(this.g(this.cantidadRecibida_Credito).value),this.g(this.cambio_Credito).setValue(Math.abs(o))}}guardarVenta(){if(this.formContado.valid||this.formCredito.valid){const e=this.products.filter(r=>"montura"==r.tipo),o=this.products.filter(r=>"luna"==r.tipo),a=this.products.filter(r=>"accesorio"==r.tipo);if(this.venta.list_monturas=e,this.venta.list_lunas=o,this.venta.list_accesorios=a,this.venta.fecha_creacion_venta=new Date(Date.now()),"contado"==this.selectorPago){if(this.tipoPago.observaciones=this.f(this.observaciones_Contado).value,this.tipoPago.cantidad_recibida=Number(this.f(this.cantidadRecibida_Contado).value),this.f(this.cantidadRecibida_Contado).value-this.precioTotalVenta<0)return void(0,p.H)("error","El pago no puede ser menor al valor de la compra, se sugiere compra al cr\xe9dito");if(this.tipoPago.deuda=0,this.tipoPago.metodo_pago=this.f(this.metodoPagoContado).value,this.tipoPago.cuotas=String(0),null==this.listClients.find(c=>c.id_cliente==this.f(this.nombreContado).value.id_cliente))return void this.f(this.nombreContado).setValue(null);this.venta.id_cliente=this.f(this.nombreContado).value.id_cliente}else{if(this.precioTotalVenta-this.g(this.cantidadRecibida_Credito).value<0)return void(0,p.H)("error","El pago no puede ser mayor al valor de la compra, se sugiere compra al contado");if(this.tipoPago.observaciones=this.g(this.observaciones_Credito).value,this.tipoPago.cantidad_recibida=Number(this.g(this.cantidadRecibida_Credito).value),this.tipoPago.deuda=(0,S.NM)(this.precioTotalVenta-this.g(this.cantidadRecibida_Credito).value,1),this.tipoPago.metodo_pago=this.g(this.metodoPagoCredito).value,this.tipoPago.cuotas=String(this.tickValue),null==this.listClients.find(c=>c.id_cliente==this.g(this.nombreCredito).value.id_cliente))return void this.g(this.nombreCredito).setValue(null);this.venta.id_cliente=this.g(this.nombreCredito).value.id_cliente}this.venta.id_vendedor=this.usuarioService.getUser().id_usuario,this.venta.nombre_vendedor=this.usuarioService.getUser().nombres+" "+this.usuarioService.getUser().apellidos,this.tipoPago.forma_pago=this.selectorPago,this.tipoPago.precio_total=this.precioTotalVenta,this.tipoPago.fecha_pago=new Date,this.venta.tipo_venta.push(this.tipoPago),this.venta.id_sede=this.idSede,this.venta.habilitado=!0,this.cancel()}}cancel(){const e=T().mixin({customClass:{cancelButton:"btn btn-danger ms-2",confirmButton:"btn btn-success"},buttonsStyling:!1});e.fire({title:"\xbfEst\xe1 seguro de realizar la venta?",text:"\xa1No se podr\xe1 revertir esto!",icon:"warning",cancelButtonText:"No, cancelar!",confirmButtonText:"Si, vender!",showCancelButton:!0}).then(o=>{o.value?((0,p.H)("loading","Cargando..."),this.productosService.createVenta(this.venta).subscribe(a=>{this.createPDF(this.venta,this.customer),(0,p.H)("close",null),(0,p.H)("success","Venta realizada"),this.modalService.dismissAll(),this.products=[],this.getListMonturas(this.idSede),this.estadoBotonGuardar()},a=>{(0,p.H)("close",null),404!==a.status&&(0,p.H)("error","Error en la conexi\xf3n")})):o.dismiss===T().DismissReason.cancel&&(this.venta.tipo_venta=[],e.fire("Cancelado","La venta no se ha realizado","error"))})}createPDF(e,o){return(0,nt.mG)(this,void 0,void 0,function*(){var c=new Date(e.fecha_creacion_venta).toLocaleDateString("en-GB"),u=new Date(e.fecha_creacion_venta).toLocaleDateString("es-CL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),v=new Date(e.fecha_creacion_venta).toLocaleTimeString("es-CL",{timeZone:"America/Bogota",hour12:!0,hour:"numeric",minute:"2-digit",second:"2-digit"}),Y=o.nombres+" "+o.apellidos,$=o.fecha_nacimiento?new Date(o.fecha_nacimiento).toLocaleDateString("en-GB"):"Sin fecha de nacimiento",G=o.email?o.email:"Sin correo",j=o.telefono?o.telefono:"Sin telefono",q=[];const tt={pageSize:"A4",pageMargins:[40,60,40,60],content:[{style:"tableMargin",table:{widths:["*","*"],body:[[{image:yield(0,S.up)("/assets/images/logo-dark.png"),width:150},{text:"",style:"tableHeader",rowSpan:3,alignment:"right"}],[{text:"Calle Santa Marta 218, Arequipa",style:"datosempresa"},{}],[{text:"raulcg1234@hotmail.com ",style:"datosempresa"},{}],[{text:"955 739 464",style:"datosempresa"},{}]]},layout:"noBorders"},{style:"tableMargin",table:{widths:["*","*"],body:[[{text:"Facturado a:",style:"tableHeader"},{text:"Fecha de la Boleta:",style:"tableHeader",alignment:"right"}],[{text:Y,style:"subtitulo"},{text:c,style:"contenido",alignment:"right"}],[{text:"Fecha de Nacimiento: "+$,style:"contenido"},{text:"",style:"tableHeader",alignment:"right"}],[{text:"Correo: "+G,style:"contenido"},{text:"",style:"contenido",alignment:"right"}],[{text:"Telefono: "+j,style:"contenido"},{}]]},layout:"noBorders"},{text:"Resumen del pedido:",style:"subtitulo"},(_=q,f=["num_orden","detalle","precio","cantidad","total"],b=function(){var f,b,_=1,Z=0,A=0;if(e.list_monturas.length>0)for(var s=0;s<e.list_monturas.length;s++)A+=f=e.list_monturas[s].precio_montura_v*e.list_monturas[s].cant_vendida,q.push({num_orden:_+=1,detalle:e.list_monturas[s].marca,precio:e.list_monturas[s].precio_montura_v,cantidad:e.list_monturas[s].cant_vendida,total:f});if(e.list_lunas.length>0)for(s=0;s<e.list_lunas.length;s++)A+=b=e.list_lunas[s].precio_luna_v*e.list_lunas[s].cant_vendida,q.push({num_orden:_+=1,detalle:e.list_lunas[s].material,precio:e.list_lunas[s].precio_luna_v,cantidad:e.list_lunas[s].cant_vendida,total:b});if(e.list_accesorios.length>0)for(s=0;s<e.list_accesorios.length;s++)A+=Z=e.list_accesorios[s].precio_accesorio_v*e.list_accesorios[s].cant_vendida,q.push({num_orden:_+=1,detalle:e.list_accesorios[s].nombre_accesorio,precio:e.list_accesorios[s].precio_accesorio_v,cantidad:e.list_accesorios[s].cant_vendida,total:Z});return A}(),{style:"tableMargin",color:"#444",table:{widths:[25,"*",63,60,63],heights:[20,20,20,20],headerRows:1,body:function(_,f,b){var Z=[];Z.push([{text:"No.",style:"tableHeader",alignment:"center"},{text:"Detalle",style:"tableHeader",alignment:"center"},{text:"Precio",style:"tableHeader",alignment:"center"},{text:"Cantidad",style:"tableHeader",alignment:"center"},{text:"Total",style:"tableHeader",alignment:"center"}]),_.forEach(function(s){var J=[];f.forEach(function(et){J.push(s[et].toString())}),Z.push(J)});var A=(0,S.NM)(b,1);return Z.push([{text:"",border:[!1,!1,!1,!1],colSpan:2},{},{text:"Total:",style:"tableHeader",alignment:"right",colSpan:2},{},{text:"S/ "+A,style:"contenido",alignment:"right"}]),Z}(_,f,b)}}),{text:[,{text:"Fecha de Entrega: ",style:"textBold"},u,"   ",{text:"Hora: ",style:"textBold"},v]},{text:"Nota:",style:"subtitulo2"},{text:"Todo trabajo se efectuara con un adelanto del 50%.",style:"contenido2",alignment:"justify"},{text:"La empresa no se responsabiliza de los pedidos no recogidos despu\xe9s de un mes.",style:"contenido2",alignment:"justify"}],styles:{subtitulo:{bold:!0,fontSize:13,color:"black",margin:[0,10,0,5]},subtitulo2:{bold:!0,fontSize:10,color:"black",margin:[0,10,0,5]},contenido:{fontSize:12},contenido2:{fontSize:8},textBold:{fontSize:12,bold:!0},datosempresa:{fontSize:10},header:{fontSize:17,bold:!0,margin:[0,0,0,10]},subheader:{fontSize:13,bold:!0,margin:[0,10,0,5]},subtitle:{fontSize:12,bold:!0,margin:[0,10,0,5]},tableMargin:{margin:[0,15,0,15]},tableOpacityExample:{margin:[0,5,0,15],fillColor:"blue",fillOpacity:.3},tableHeader:{bold:!0,fontSize:13,color:"black"}}};var _,f,b;E().createPdf(tt).open()})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(lt),t.Y36(d.qu),t.Y36(m.FF),t.Y36(Ut.k),t.Y36(ut.$),t.Y36(z.i))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-add-sale"]],viewQuery:function(e,o){if(1&e&&(t.Gf(Pt,5),t.Gf(qt,5)),2&e){let a;t.iGM(a=t.CRH())&&(o.autocomplete=a.first),t.iGM(a=t.CRH())&&(o.headers=a)}},features:[t._Bn([lt,g.JJ])],decls:55,vars:12,consts:[[1,"container-fluid"],["title","A\xf1adir un Producto",3,"breadcrumbItems"],[1,"row","mb-3"],[1,"col-md-9","mb-2","search-box","chat-search-box"],[1,"position-relative"],["placeholder","Buscar productos","historyIdentifier","","focusFirst","true",3,"data","searchKeyword","itemTemplate","notFoundTemplate","selected","inputChanged","inputFocused","keyup.enter"],["autocomplete",""],["itemTemplate",""],["notFoundTemplate",""],[1,"col-md-3","mb-2"],["role","toolbar",1,"btn-toolbar"],["class","col-12 d-grid",4,"appRole"],[1,"row","mb-4"],[1,"row"],[1,"col-lg-12"],[1,"card"],[1,"card-body"],[1,"card-title","mb-4"],[1,"table-responsive"],[1,"table","table-centered","dt-responsive","table-nowrap","mb-0","align-middle",2,"border-spacing","0 12px","width","100%"],[1,"table-light"],[1,"bg-transparent"],[4,"ngFor","ngForOf"],[1,"text-end","mt-2"],["type","submit","id","btn-save-event",1,"btn","btn-success","ms-1",3,"disabled","click"],[1,"uil","uil-shopping-cart-alt","mt-2","me-1"],["centerDataModalEditar",""],["centerDataModalGuardar2",""],["scrollDataModal",""],[3,"innerHTML"],[1,"col-12","d-grid"],[3,"formGroup"],["ngbDropdown",""],["placeholder","Seleccione la sede","bindValue","id_sede","bindLabel","nombre_sede",3,"items","formControlName","change"],[3,"result"],[4,"ngIf"],["placement","top","ngbTooltip","Disminuir",1,"px-2","text-warning"],[1,"uil","uil-minus-circle","font-size-18",3,"click"],["placement","top","ngbTooltip","Agregar",1,"px-2","text-success"],["name","quantity","ngDefaultControl","","min","0",1,"uil","uil-plus-circle","font-size-18",3,"ngModel","ngModelChange","click"],["placement","top","ngbTooltip","Editar precio",1,"px-2","text-primary",3,"click"],[1,"uil","uil-pen","font-size-18"],["placement","top","ngbTooltip","Eliminar",1,"px-2","text-danger"],[1,"uil","uil-trash-alt","font-size-18",3,"click"],[1,"modal-header"],[1,"modal-title","mt-0"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"col-sm-6"],["for","billing-PrecioOriginal",1,"form-label"],["type","text","id","billing-PrecioOriginal","placeholder","Precio Original",1,"form-control",3,"formControlName"],[1,"mb-4"],["for","billing-NuevoPrecio",1,"form-label"],["type","text","id","billing-NuevoPrecio","placeholder","Escriba el nuevo precio",1,"form-control",3,"formControlName","ngClass"],[1,"invalid-feedback"],[1,"modal-footer"],["type","button",1,"btn","btn-danger",3,"click"],["type","submit","id","btn-save-event",1,"btn","btn-success","ms-1",3,"click"],["id","modal-title",1,"modal-title"],[1,"modal-body","p-4"],[1,"col-lg-14"],["ngbNav","",1,"nav-pills","nav-justified","bg-light",3,"activeId","navChange"],["justifiednavpills","ngbNav"],[3,"ngbNavItem"],["ngbNavLink",""],[1,"d-block","d-sm-none"],[1,"fas","fa-home"],[1,"d-none","d-sm-block"],["ngbNavContent",""],[1,"far","fa-user"],[3,"ngbNavOutlet"],[3,"formGroup","ngSubmit"],[1,"row","mt-4"],[1,"col-4"],[1,"mb-3"],[1,"control-label"],["placeholder","Cantidad en soles","type","text","name","nameCantidadRecibidaContado",1,"form-control",3,"formControlName","change"],["class","text-danger",4,"ngIf"],[1,"form-label"],["name","selectMetodo","placeholder","Seleccione",3,"items","formControlName"],["placeholder","Seleccione la fecha","type","text","name","nameFechaRegistroContado",1,"form-control",3,"formControlName","ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"col-12"],["placeholder","Apellidos del cliente","historyIdentifier","",3,"data","searchKeyword","itemTemplate","formControlName","notFoundTemplate","selected"],["itemTemplate3",""],[1,"control-label",2,"text-align","left"],["placeholder","S/ 000.00","type","text","name","nameTotalContado",1,"form-control",3,"formControlName","ngClass"],["placeholder","S/ 000.00","type","text","name","namePagoContado",1,"form-control",3,"formControlName","ngClass"],["placeholder","S/ 000.00","type","text","name","nameCambioContado",1,"form-control",3,"formControlName","ngClass"],["for","billing-observaciones",1,"form-label"],["id","billing-observaciones","rows","3","placeholder","Ingrese las observaciones",1,"form-control",3,"formControlName"],[1,"text-danger"],["placeholder","Cantidad en soles","type","text","name","nameCantidadRecibidaCredito",1,"form-control",3,"formControlName","change"],["placeholder","Seleccione la fecha","type","text","name","nameFechaRegistroCredito",1,"form-control",3,"formControlName","ngClass"],[1,"p-3"],[3,"value","options","valueChange"],["placeholder","Apellidos del cliente","historyIdentifier","",3,"data","searchKeyword","itemTemplate","notFoundTemplate","formControlName","selected"],["itemTemplate2",""],["placeholder","S/ 000.00","type","text","name","nameTotalCredito",1,"form-control",3,"formControlName","ngClass"],["placeholder","S/ 000.00","type","text","name","namePagoCredito",1,"form-control",3,"formControlName","ngClass"],["placeholder","S/ 000.00","type","text","name","nameCambioCredito",1,"form-control",3,"formControlName","ngClass"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"invoice-title"],[1,"float-end","font-size-16"],[1,"badge","bg-success","font-size-12","ms-2"],["src","assets/images/logo-dark.png","alt","logo","height","20"],[1,"text-muted"],[1,"mb-1"],[1,"uil","uil-map-marker","me-1"],[1,"uil","uil-envelope-alt","me-1"],[1,"uil","uil-phone","me-1"],[1,"my-4"],[1,"font-size-16","mb-3"],[1,"font-size-15","mb-2"],[1,"text-muted","text-sm-end"],[1,"font-size-16","mb-1"],[1,"mt-4"],[1,"py-2"],[1,"font-size-15"],[1,"table","table-nowrap","table-centered","mb-0"],[2,"width","70px"],[1,"text-end",2,"width","120px"],["scope","row"],[1,"font-size-15","mb-1"],[1,"list-inline","mb-0"],[1,"list-inline-item"],[1,"fw-medium"],[1,"text-end"],["scope","row","colspan","4",1,"text-end"],["scope","row","colspan","4",1,"border-0","text-end"],[1,"border-0","text-end"],[1,"m-0"],["href","javascript(0)",1,"btn","btn-success","waves-effect","waves-light","me-1"],[1,"fa","fa-download"],["href","javascript:window.print()",1,"btn","btn-success","waves-effect","waves-light","me-1"],[1,"fa","fa-print"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary"]],template:function(e,o){if(1&e){const a=t.EpF();t.TgZ(0,"div",0),t._UZ(1,"app-page-title",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"div",4),t.TgZ(5,"ng-autocomplete",5,6),t.NdJ("selected",function(c){return o.selectEvent(c)})("inputChanged",function(c){return o.onChangeSearch(c)})("inputFocused",function(c){return o.onFocused(c)})("keyup.enter",function(c){return o.selectEvent(c)}),t.qZA(),t.YNc(7,Jt,1,1,"ng-template",null,7,t.W1O),t.YNc(9,Mt,1,1,"ng-template",null,8,t.W1O),t.qZA(),t.qZA(),t.TgZ(11,"div",9),t.TgZ(12,"div",10),t.YNc(13,wt,4,3,"div",11),t.qZA(),t.qZA(),t.qZA(),t.TgZ(14,"div",12),t.TgZ(15,"h4"),t._uU(16),t.ALo(17,"currency"),t.qZA(),t.qZA(),t.TgZ(18,"div",13),t.TgZ(19,"div",14),t.TgZ(20,"div",15),t.TgZ(21,"div",16),t.TgZ(22,"h4",17),t._uU(23,"Lista de Productos"),t.qZA(),t.TgZ(24,"div",18),t.TgZ(25,"form"),t.TgZ(26,"table",19),t.TgZ(27,"thead",20),t.TgZ(28,"tr",21),t.TgZ(29,"th"),t._uU(30,"ID Producto"),t.qZA(),t.TgZ(31,"th"),t._uU(32,"Tipo"),t.qZA(),t.TgZ(33,"th"),t._uU(34,"Detalle"),t.qZA(),t.TgZ(35,"th"),t._uU(36,"Cantidad"),t.qZA(),t.TgZ(37,"th"),t._uU(38,"Precio"),t.qZA(),t.TgZ(39,"th"),t._uU(40,"Total"),t.qZA(),t.TgZ(41,"th"),t._uU(42,"Acci\xf3n"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(43,"tbody"),t.YNc(44,Dt,25,14,"tr",22),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(45,"div",23),t.TgZ(46,"button",24),t.NdJ("click",function(){t.CHM(a);const c=t.MAs(52);return o.centerModal(c,o.products)}),t._UZ(47,"i",25),t._uU(48," Guardar "),t.qZA(),t.qZA(),t.qZA(),t.YNc(49,Ht,24,8,"ng-template",null,26,t.W1O),t.YNc(51,ce,23,4,"ng-template",null,27,t.W1O),t.YNc(53,ue,152,0,"ng-template",null,28,t.W1O)}if(2&e){const a=t.MAs(8),r=t.MAs(10);t.xp6(1),t.Q6J("breadcrumbItems",o.breadCrumbItems),t.xp6(4),t.Q6J("data",o.listAllProducts)("searchKeyword",o.keyword)("itemTemplate",a)("notFoundTemplate",r),t.xp6(8),t.Q6J("appRole",o.role),t.xp6(3),t.hij("Total de la Venta: PEN ",t.xi3(17,9,o.getTotalCost(),"S/ "),""),t.xp6(28),t.Q6J("ngForOf",o.products),t.xp6(2),t.Q6J("disabled",!o.btnGuardar)}},directives:[H.V,mt.YR,R.g,d._Y,d.JL,d.F,g.sg,d.sg,m.jt,w.w9,d.JJ,d.u,m._h,g.O5,m._L,d.Fj,d.On,g.mk,m.Pz,m.nv,m.Vx,m.uN,m.tO,ot.w5],pipes:[g.H9],styles:[""]}),i})();var U=l(18260),_e=l(44522);let V=(()=>{class i{constructor(e){this.http=e}getVentas(){return this.http.get(U.N.urlBackend+"getAllVentas")}getVentasbySede(e){return this.http.get(U.N.urlBackend+"getAllVentasBySede/"+e)}getVentasByDate(e,o,a){return this.http.get(U.N.urlBackend+"getAllVentasByDate/"+e+"/"+o+"/"+a)}darBajaVenta(e){return this.http.put(U.N.urlBackend+"unsubscribeVentasById/"+e,e)}updatePagoCuotas(e,o){return this.http.put(U.N.urlBackend+"updatePagoCuotasVentaById/"+e,o)}getVentasEliminadasbySede(e){return this.http.get(U.N.urlBackend+"getAllVentasEliminadasBySede/"+e)}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(_e.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),_t=(()=>{class i{constructor(e,o,a){this.pipe=e,this.ventaService=o,this.usuarioService=a,this._loading$=new N.X(!0),this._search$=new rt.xQ,this._total$=new N.X(0),this._mostrar$=new N.X(!1),this._ventas$=new N.X([]),this.ventaList=[],this._state={page:1,pageSize:10,searchTerm:"",sortColumn:"",sortDirection:""},this.getAllVentas()}get transactions$(){return this._ventas$.asObservable()}get total$(){return this._total$.asObservable()}get loading$(){return this._loading$.asObservable()}get page(){return this._state.page}get pageSize(){return this._state.pageSize}get searchTerm(){return this._state.searchTerm}get mostrar(){return this._mostrar$.asObservable()}set page(e){this._set({page:e})}set pageSize(e){this._set({pageSize:e})}set searchTerm(e){this._set({searchTerm:e})}set sortColumn(e){this._set({sortColumn:e})}set sortDirection(e){this._set({sortDirection:e})}_set(e){Object.assign(this._state,e),this._search$.next()}updateTable(e){this.ventaList=e,this._mostrar$.next(!0),this._search$.pipe((0,y.b)(()=>this._loading$.next(!0)),(0,D.b)(200),(0,Q.w)(()=>this._search()),(0,I.g)(200),(0,y.b)(()=>this._loading$.next(!1))).subscribe(o=>{this._ventas$.next(o.transactions),this._total$.next(o.total)}),this._search$.next()}_search(){const{sortColumn:e,sortDirection:o,pageSize:a,page:r,searchTerm:c}=this._state;let u=function(i,n,e){return""===e||""===n?i:[...i].sort((o,a)=>{const r=((i,n)=>i<n?-1:i>n?1:0)(o[n],a[n]);return"asc"===e?r:-r})}(this.ventaList,e,o);u=u.filter(C=>function(i,n,e){return i.nombre_vendedor.toLowerCase().includes(n)||String(i.tipo_venta[0].precio_total).toLowerCase().includes(n.toLowerCase())||i.fecha_creacion_venta.toLocaleString().includes(n)}(C,c));const v=u.length;return u=u.slice((r-1)*a,(r-1)*a+a),(0,st.of)({transactions:u,total:v})}getAllVentas(){this.ventaService.getVentasbySede(this.usuarioService.getSedebyUser()).subscribe(e=>{this.ventaList=e,this._mostrar$.next(!0),this._search$.pipe((0,y.b)(()=>this._loading$.next(!0)),(0,D.b)(200),(0,Q.w)(()=>this._search()),(0,I.g)(200),(0,y.b)(()=>this._loading$.next(!1))).subscribe(o=>{this._ventas$.next(o.transactions),this._total$.next(o.total)}),this._search$.next()})}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(g.JJ),t.LFG(V),t.LFG(z.i))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Ze={asc:"desc",desc:"","":"asc"};let fe=(()=>{class i{constructor(){this.sortable="",this.direction="",this.sort=new t.vpe}rotate(){this.direction=Ze[this.direction],this.sort.emit({column:this.sortable,direction:this.direction})}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=t.lG2({type:i,selectors:[["th","sortable",""]],hostVars:4,hostBindings:function(e,o){1&e&&t.NdJ("click",function(){return o.rotate()}),2&e&&t.ekj("asc","asc"===o.direction)("desc","desc"===o.direction)},inputs:{sortable:"sortable",direction:"direction"},outputs:{sort:"sort"}}),i})();var be=l(7082),ve=l.n(be),pt=l(19039),L=l(45788);function Ce(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",35),t.TgZ(1,"form",36),t.TgZ(2,"div",37),t.TgZ(3,"ng-select",38),t.NdJ("change",function(){return t.CHM(e),t.oxw().changeSedes()}),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("formGroup",e.formSedes),t.xp6(2),t.s9C("formControlName",e.nombre_sedes),t.Q6J("items",e.listSedes)}}function Ae(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",39),t.TgZ(1,"div",40),t.TgZ(2,"input",41),t.NdJ("click",function(){return t.CHM(e),t.oxw().exportarVentas()}),t.qZA(),t.qZA(),t.qZA()}}function Te(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",42),t.TgZ(1,"div",6),t.TgZ(2,"form",36),t.TgZ(3,"div",43),t._UZ(4,"input",44),t._UZ(5,"input",44),t.TgZ(6,"button",45),t.NdJ("click",function(){return t.CHM(e),t.oxw().filterDateRange()}),t._UZ(7,"i",46),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("formGroup",e.formDateRange),t.xp6(2),t.s9C("formControlName",e.fechaDesde),t.xp6(1),t.s9C("formControlName",e.fechaHasta)}}const gt=function(i){return{"bg-soft-danger":i}};function xe(i,n){if(1&i&&(t.TgZ(0,"td"),t.TgZ(1,"span",56),t._uU(2,"Deuda \xa0"),t.qZA(),t.TgZ(3,"span",57),t._uU(4),t.qZA(),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(3),t.Q6J("ngClass",t.VKq(2,gt,e.tipo_venta[0].deuda>0)),t.xp6(1),t.hij(" ",e.tipo_venta[0].deuda," ")}}function qe(i,n){1&i&&(t.TgZ(0,"td"),t.TgZ(1,"span",58),t._uU(2,"Pagado"),t.qZA(),t.qZA())}function Se(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"a",59),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,r=t.oxw(),c=t.MAs(64);return r.centerModalActualizar(c,a)}),t._UZ(1,"i",60),t.qZA()}}function Ne(i,n){1&i&&t._UZ(0,"i",63)}function ye(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"a",61),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().eliminar(a)}),t.YNc(1,Ne,1,0,"i",62),t.qZA()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("appRole",e.role)}}function Ue(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"tr",47),t.TgZ(1,"td"),t._UZ(2,"ngb-highlight",48),t.qZA(),t.TgZ(3,"td"),t._UZ(4,"ngb-highlight",48),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"td"),t.TgZ(7,"div",49),t.TgZ(8,"span",50),t._uU(9),t.qZA(),t.qZA(),t._UZ(10,"ngb-highlight",48),t.qZA(),t.TgZ(11,"td"),t._UZ(12,"ngb-highlight",48),t.ALo(13,"currency"),t.qZA(),t.TgZ(14,"td"),t._UZ(15,"ngb-highlight",48),t.qZA(),t.YNc(16,xe,5,4,"td",51),t.YNc(17,qe,3,0,"td",51),t.TgZ(18,"td"),t.TgZ(19,"div"),t.TgZ(20,"button",52),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw().createPDF(r)}),t._uU(21,"Pdf "),t._UZ(22,"i",53),t.qZA(),t.qZA(),t.qZA(),t.TgZ(23,"td"),t.YNc(24,Se,2,0,"a",54),t.YNc(25,ye,2,1,"a",55),t.qZA(),t.qZA()}if(2&i){const e=n.$implicit,o=n.index,a=t.oxw();t.xp6(2),t.Q6J("result",o+1)("term",a.service.searchTerm),t.xp6(2),t.Q6J("result",t.xi3(5,15,e.fecha_creacion_venta,"dd/MM/yyyy"))("term",a.service.searchTerm),t.xp6(5),t.hij(" ",e.nombre_cliente.charAt(0)," "),t.xp6(1),t.Q6J("result",e.nombre_cliente)("term",a.service.searchTerm),t.xp6(2),t.Q6J("result",t.xi3(13,18,e.tipo_venta[0].precio_total,"S/ "))("term",a.service.searchTerm),t.xp6(3),t.Q6J("result",e.nombre_vendedor)("term",a.service.searchTerm),t.xp6(1),t.Q6J("ngIf",e.tipo_venta[0].deuda>0),t.xp6(1),t.Q6J("ngIf",0==e.tipo_venta[0].deuda),t.xp6(7),t.Q6J("ngIf",0!=e.tipo_venta[0].deuda),t.xp6(1),t.Q6J("appRole",a.role)}}function Pe(i,n){1&i&&(t.TgZ(0,"div",2),t.TgZ(1,"div",19),t.TgZ(2,"div",64),t.TgZ(3,"a",65),t._UZ(4,"i",66),t._uU(5," Cargando "),t.qZA(),t.qZA(),t.qZA(),t.qZA())}function Je(i,n){1&i&&(t.TgZ(0,"div",56),t._uU(1," Campo requerido "),t.qZA())}function Me(i,n){1&i&&(t.TgZ(0,"div",56),t._uU(1," Ingrese solo n\xfameros "),t.qZA())}function we(i,n){if(1&i&&(t.TgZ(0,"div",56),t.YNc(1,Je,2,0,"div",82),t.YNc(2,Me,2,0,"div",82),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",null==e.formCreditoActualizacion.controls.campoCantidadRecibidaCreditoActualizacion.errors?null:e.formCreditoActualizacion.controls.campoCantidadRecibidaCreditoActualizacion.errors.required),t.xp6(1),t.Q6J("ngIf",null==e.formCreditoActualizacion.controls.campoCantidadRecibidaCreditoActualizacion.errors?null:e.formCreditoActualizacion.controls.campoCantidadRecibidaCreditoActualizacion.errors.pattern)}}function Ee(i,n){1&i&&(t.TgZ(0,"div",56),t._uU(1," Campo requerido "),t.qZA())}function ze(i,n){if(1&i&&(t.TgZ(0,"div",56),t.YNc(1,Ee,2,0,"div",82),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",null==e.formCreditoActualizacion.controls.campoMetodoPagoCreditoActualizacion.errors?null:e.formCreditoActualizacion.controls.campoMetodoPagoCreditoActualizacion.errors.required)}}function Ve(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"This value is required."),t.qZA())}function Le(i,n){if(1&i&&(t.TgZ(0,"div",103),t.YNc(1,Ve,2,0,"span",51),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.form.title.errors.required)}}function ke(i,n){if(1&i&&(t.TgZ(0,"tr"),t.TgZ(1,"th",104),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"currency"),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.ALo(10,"date"),t.qZA(),t.qZA()),2&i){const e=n.$implicit,o=n.index;t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(t.xi3(5,4,e.cantidad_recibida,"S/ ")),t.xp6(3),t.Oqu(e.metodo_pago),t.xp6(2),t.Oqu(t.xi3(10,7,e.fecha_pago,"dd/MM/yyyy hh:mm:ss"))}}const k=function(i){return{"is-invalid":i}};function Fe(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",67),t.TgZ(1,"h5",68),t._uU(2,"Actualizar Venta - Al Credito"),t.qZA(),t.TgZ(3,"button",69),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeEventModal()}),t.qZA(),t.qZA(),t.TgZ(4,"div",70),t.TgZ(5,"div",71),t.TgZ(6,"form",36),t.TgZ(7,"div",2),t.TgZ(8,"div",72),t.TgZ(9,"div",73),t.TgZ(10,"label",74),t._uU(11,"Nombres y Apellidos del Cliente"),t.qZA(),t.TgZ(12,"h5"),t._uU(13),t.qZA(),t.qZA(),t.qZA(),t.TgZ(14,"div",72),t.TgZ(15,"div",75),t.TgZ(16,"div",76),t.TgZ(17,"div",77),t._uU(18,"Deuda \xa0"),t.qZA(),t.TgZ(19,"div",78),t._uU(20),t.ALo(21,"currency"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(22,"div",79),t.TgZ(23,"div",2),t.TgZ(24,"div",80),t.TgZ(25,"div",73),t.TgZ(26,"label",74),t._uU(27,"Cantidad Recibida"),t.qZA(),t.TgZ(28,"input",81),t.NdJ("change",function(a){return t.CHM(e),t.oxw().updatePago(a)}),t.qZA(),t.YNc(29,we,3,2,"div",82),t.qZA(),t.qZA(),t.TgZ(30,"div",80),t.TgZ(31,"div",73),t.TgZ(32,"label",83),t._uU(33,"M\xe9todo"),t.qZA(),t._UZ(34,"ng-select",84),t.YNc(35,ze,2,1,"div",82),t.qZA(),t.qZA(),t.TgZ(36,"div",80),t.TgZ(37,"div",73),t.TgZ(38,"label",74),t._uU(39,"Fecha"),t.qZA(),t._UZ(40,"input",85),t.YNc(41,Le,2,1,"div",86),t.qZA(),t.qZA(),t.qZA(),t.TgZ(42,"div",2),t.TgZ(43,"div",19),t.TgZ(44,"div",73),t.TgZ(45,"label",74),t._uU(46),t.qZA(),t.TgZ(47,"div",2),t.TgZ(48,"div",87),t.TgZ(49,"div",88),t.TgZ(50,"table",89),t.TgZ(51,"thead"),t.TgZ(52,"tr"),t.TgZ(53,"th",90),t._uU(54,"N\xba Cuotas"),t.qZA(),t.TgZ(55,"th"),t._uU(56,"Monto"),t.qZA(),t.TgZ(57,"th"),t._uU(58,"M\xe9todo"),t.qZA(),t.TgZ(59,"th"),t._uU(60,"Fecha"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(61,"tbody"),t.YNc(62,ke,11,10,"tr",91),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(63,"div",2),t.TgZ(64,"div",19),t.TgZ(65,"label",92),t._uU(66,"Montos:"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(67,"div",2),t.TgZ(68,"div",80),t.TgZ(69,"div",73),t.TgZ(70,"label",74),t._uU(71,"Total"),t.qZA(),t._UZ(72,"input",93),t.qZA(),t.qZA(),t.TgZ(73,"div",80),t.TgZ(74,"div",73),t.TgZ(75,"label",74),t._uU(76,"Pago"),t.qZA(),t._UZ(77,"input",94),t.qZA(),t.qZA(),t.TgZ(78,"div",80),t.TgZ(79,"div",73),t.TgZ(80,"label",74),t._uU(81,"Deuda"),t.qZA(),t._UZ(82,"input",95),t.qZA(),t.qZA(),t.qZA(),t.TgZ(83,"div",2),t.TgZ(84,"div",96),t.TgZ(85,"div",97),t.TgZ(86,"label",98),t._uU(87,"Observaciones"),t.qZA(),t._UZ(88,"textarea",99),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(89,"div",100),t.TgZ(90,"button",101),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeEventModal()}),t._uU(91," Cerrar "),t.qZA(),t.TgZ(92,"button",102),t.NdJ("click",function(){return t.CHM(e),t.oxw().guardarActualizacionDeuda()}),t._uU(93," Registrar Venta "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(6),t.Q6J("formGroup",e.formCreditoActualizacion),t.xp6(7),t.Oqu(e.usuario.nombre),t.xp6(6),t.Q6J("ngClass",t.VKq(25,gt,!0)),t.xp6(1),t.hij(" ",t.xi3(21,22,e.usuario.deuda,"S/ ")," "),t.xp6(8),t.s9C("formControlName",e.cantidadRecibida_CreditoActualizacion),t.xp6(1),t.Q6J("ngIf",e.formCreditoActualizacion.controls.campoCantidadRecibidaCreditoActualizacion.invalid&&(e.formCreditoActualizacion.controls.campoCantidadRecibidaCreditoActualizacion.dirty||e.formCreditoActualizacion.controls.campoCantidadRecibidaCreditoActualizacion.touched)),t.xp6(5),t.s9C("formControlName",e.metodoPagoCreditoActualizacion),t.Q6J("items",e.listMetodosPagos),t.xp6(1),t.Q6J("ngIf",e.formCreditoActualizacion.controls.campoMetodoPagoCreditoActualizacion.invalid&&(e.formCreditoActualizacion.controls.campoMetodoPagoCreditoActualizacion.dirty||e.formCreditoActualizacion.controls.campoMetodoPagoCreditoActualizacion.touched)),t.xp6(5),t.s9C("formControlName",e.fechaVenta_CreditoActualizacion),t.Q6J("ngClass",t.VKq(27,k,e.submitted&&e.form.title.errors)),t.xp6(1),t.Q6J("ngIf",e.submitted&&e.form.title.errors),t.xp6(5),t.hij("Informaci\xf3n de Pagos: ",e.usuario.listDeudas[0].cuotas," cuotas"),t.xp6(16),t.Q6J("ngForOf",e.usuario.listDeudas),t.xp6(10),t.s9C("formControlName",e.precioTotal_CreditoActualizacion),t.Q6J("ngClass",t.VKq(29,k,e.submitted&&e.form.title.errors)),t.xp6(5),t.s9C("formControlName",e.pago_CreditoActualizacion),t.Q6J("ngClass",t.VKq(31,k,e.submitted&&e.form.title.errors)),t.xp6(5),t.s9C("formControlName",e.cambio_CreditoActualizacion),t.Q6J("ngClass",t.VKq(33,k,e.submitted&&e.form.title.errors)),t.xp6(6),t.s9C("formControlName",e.observaciones_CreditoActualizacion),t.xp6(4),t.Q6J("disabled",!e.formCreditoActualizacion.valid)}}function Qe(i,n){if(1&i&&(t.TgZ(0,"div",17),t.TgZ(1,"form",18),t.TgZ(2,"div",19),t._UZ(3,"ng-select",20),t.qZA(),t.qZA(),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("formGroup",e.formSedes),t.xp6(2),t.s9C("formControlName",e.nombre_sedes),t.Q6J("items",e.listSedes)}}E().vfs=ct.I.vfs;const He=[{path:"addsale",component:me,data:{role:["Vendedor","Admin"]},canActivate:[F.a]},{path:"listsales",component:(()=>{class i{constructor(e,o,a,r,c,u,v){this.service=e,this.fb=o,this.ventasService=a,this.modalService=r,this.customerService=c,this.usuarioService=u,this.ventaService=v,this.role="Admin",this.nombre_sedes="campoSede",this.idSede="",this.mostrarSpinner=!1,this.submitted_CreditoActualizacion=!1,this.cantidadRecibida_CreditoActualizacion="campoCantidadRecibidaCreditoActualizacion",this.fechaVenta_CreditoActualizacion="campoFechaVentaCreditoActualizacion",this.usuario_CreditoActualizacion="campoUsuarioCreditoActualizacion",this.nombreCreditoActualizacion="campoNombreCreditoActualizacion",this.precioTotal_CreditoActualizacion="campoPrecioTotalCreditoActualizacion",this.pago_CreditoActualizacion="campoPagoCreditoActualizacion",this.cambio_CreditoActualizacion="campoCambioCreditoActualizacion",this.observaciones_CreditoActualizacion="campoObservacionesCreditoActualizacion",this.metodoPagoCreditoActualizacion="campoMetodoPagoCreditoActualizacion",this.numberPattern="[0-9]+",this.activePago=1,this.listMetodosPagos=["F\xedsico","Yape","Plin","Interbancario"],this.exampleOptions={altInputClass:"form-control",locale:ve().es},this.fechaDesde="campoFechaDesde",this.fechaHasta="campoFechaHasta",this.venta=new dt,this.tipoPago=[],this.decimalPattern=/^\d+(\.\d{1,2})?$/,this.excelVentas=[],this.transactions$=e.transactions$,this.total$=e.total$,e.mostrar.subscribe(C=>{this.mostrarSpinner=C})}ngOnInit(){this.breadCrumbItems=[{label:"Venta"},{label:"Lista de Ventas",active:!0}],this.getListSedes(),this.crearFormulario()}getListSedes(){this.listSedes=JSON.parse(localStorage.getItem("sedes")),this.idSede=this.usuarioService.getSedebyUser()}onSort({column:e,direction:o}){this.headers.forEach(a=>{a.sortable!==e&&(a.direction="")}),this.service.sortColumn=e,this.service.sortDirection=o}centerModalActualizar(e,o){this.crearFormularioActualizar(),this.fechaVenta=new Date(Date.now()),this.usuario={nombre:o.nombre_cliente,deuda:o.tipo_venta[0].deuda,listDeudas:o.tipo_venta},this.venta.id_ventas=o.id_ventas,this.venta.id_cliente=o.id_cliente,this.tipoPago=o.tipo_venta,this.g(this.precioTotal_CreditoActualizacion).setValue(this.usuario.deuda.toFixed(2)),this.modalService.open(e,{centered:!0,windowClass:"modal-holder"}),this.g(this.fechaVenta_CreditoActualizacion).setValue(this.fechaVenta.toLocaleDateString())}closeEventModal(){this.modalService.dismissAll()}saveEvent(){this.submitted_CreditoActualizacion=!0}crearFormulario(){this.formDateRange=this.fb.group({[this.fechaDesde]:[],[this.fechaHasta]:[]}),this.formSedes=this.fb.group({[this.nombre_sedes]:[this.idSede]})}crearFormularioActualizar(){this.formCreditoActualizacion=this.fb.group({[this.cantidadRecibida_CreditoActualizacion]:[null,[d.kI.required,d.kI.pattern(this.decimalPattern)]],[this.fechaVenta_CreditoActualizacion]:[{value:null,disabled:!0}],[this.usuario_CreditoActualizacion]:[null],[this.precioTotal_CreditoActualizacion]:[{value:null,disabled:!0}],[this.pago_CreditoActualizacion]:[{value:null,disabled:!0}],[this.cambio_CreditoActualizacion]:[{value:null,disabled:!0}],[this.observaciones_CreditoActualizacion]:[null],[this.metodoPagoCreditoActualizacion]:[null,[d.kI.required]]})}g(e){return this.formCreditoActualizacion.get(e)}updatePago(e){this.g(this.pago_CreditoActualizacion).setValue(this.g(this.cantidadRecibida_CreditoActualizacion).value);const o=Number((0,S.NM)(this.g(this.cantidadRecibida_CreditoActualizacion).value-this.usuario.deuda,1).toFixed(2));this.g(this.cambio_CreditoActualizacion).setValue(Math.abs(o))}guardarActualizacionDeuda(){if(this.formCreditoActualizacion.valid){this.venta.id_vendedor=this.usuarioService.getUser().id_usuario,this.venta.nombre_vendedor=this.usuarioService.getUser().nombres+" "+this.usuarioService.getUser().apellidos,this.venta.id_sede=this.usuarioService.getSedebyUser();let e=0;e=(0,S.NM)(this.tipoPago[0].deuda-this.g(this.cantidadRecibida_CreditoActualizacion).value,1);const o={forma_pago:"credito",cantidad_recibida:Number(this.g(this.cantidadRecibida_CreditoActualizacion).value),deuda:e,cuotas:this.tipoPago[0].cuotas,precio_total:this.tipoPago[0].precio_total,metodo_pago:this.g(this.metodoPagoCreditoActualizacion).value,fecha_pago:new Date(Date.now()),observaciones:this.g(this.observaciones_CreditoActualizacion).value};let a=[];if(this.tipoPago.length+1==Number(this.tipoPago[0].cuotas)&&e>0)return void(0,p.H)("error","Es su \xfaltima cuota, tiene que cancelar la totalidad");if(Number(this.g(this.cantidadRecibida_CreditoActualizacion).value>this.g(this.precioTotal_CreditoActualizacion).value))return void(0,p.H)("error","El pago debe ser menor a la deuda");e<=0?(o.deuda=0,a.push(o),a.push(...this.tipoPago),this.venta.tipo_venta=a,T().fire({title:"\xbfEst\xe1 seguro que desea cancelar la totalidad de la deuda?",text:"No se podr\xe1 revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Si, cancelar deuda!"}).then(r=>{r.value?((0,p.H)("loading","Cargando..."),this.ventasService.updatePagoCuotas(this.venta.id_ventas,this.venta).subscribe(c=>{(0,p.H)("close",null),(0,p.H)("success","Venta completada"),this.modalService.dismissAll(),this.updateListVentas()},c=>{(0,p.H)("close",null),(0,p.H)("error","Error en la conexi\xf3n")})):r.dismiss===T().DismissReason.cancel&&T().fire("Cancelado","Venta no eliminada","error")})):(a.push(o),a.push(...this.tipoPago),this.venta.tipo_venta=a,this.ventasService.updatePagoCuotas(this.venta.id_ventas,this.venta).subscribe(r=>{this.modalService.dismissAll(),this.updateListVentas()}))}}f(e){return this.formDateRange.get(e)}filterDateRange(){if(this.formDateRange.valid){this.idSede=this.fS(this.nombre_sedes).value;let o,e=new Date(this.f(this.fechaDesde).value+"T00:00");null!=this.f(this.fechaHasta).value?o=new Date(this.f(this.fechaHasta).value+"T23:59"):(o=new Date(Date.now()),o.setHours(23,59,0)),this.ventasService.getVentasByDate(e,o,this.idSede).subscribe(a=>{this.service.updateTable(a)})}}eliminar(e){T().fire({title:"\xbfEst\xe1 seguro que desea eliminar la venta?",text:"No se podr\xe1 revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Si, eliminar!"}).then(o=>{o.value?((0,p.H)("loading","Cargando..."),this.ventasService.darBajaVenta(e.id_ventas).subscribe(a=>{(0,p.H)("close",null),(0,p.H)("success","Venta eliminada"),this.updateListVentas()},a=>{(0,p.H)("close",null),(0,p.H)("error","Error en la conexi\xf3n")})):o.dismiss===T().DismissReason.cancel&&T().fire("Cancelado","Venta no eliminada","error")})}updateListVentas(){this.ventasService.getVentasbySede(this.idSede).subscribe(e=>{this.service.updateTable(e)})}createPDF(e){this.customerService.getAllClientbyId(e.id_cliente).subscribe(o=>{this.generatePDF(e,o[0])})}generatePDF(e,o){return(0,nt.mG)(this,void 0,void 0,function*(){var c=new Date(e.fecha_creacion_venta).toLocaleDateString("en-GB"),u=new Date(e.fecha_creacion_venta).toLocaleDateString("es-CL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),v=new Date(e.fecha_creacion_venta).toLocaleTimeString("es-CL",{timeZone:"America/Bogota",hour12:!0,hour:"numeric",minute:"2-digit",second:"2-digit"}),Y=o.nombres+" "+o.apellidos,$=o.fecha_nacimiento?new Date(o.fecha_nacimiento).toLocaleDateString("en-GB"):"Sin fecha de nacimiento",G=o.email?o.email:"Sin correo",j=o.telefono?o.telefono:"Sin telefono",q=[];const tt={pageSize:"A4",pageMargins:[40,60,40,60],content:[{style:"tableMargin",table:{widths:["*","*"],body:[[{image:yield(0,S.up)("/assets/images/logo-dark.png"),width:150},{text:"",style:"tableHeader",rowSpan:3,alignment:"right"}],[{text:"Calle Santa Marta 218, Arequipa"},{}],[{text:"raulcg1234@hotmail.com "},{}],[{text:"955 739 464"},{}]]},layout:"noBorders"},{style:"tableMargin",table:{widths:["*","*"],body:[[{text:"Facturado a:",style:"tableHeader"},{text:"Fecha de la Boleta:",style:"tableHeader",alignment:"right"}],[{text:Y,style:"subtitulo"},{text:c,style:"contenido",alignment:"right"}],[{text:"Fecha de Nacimiento: "+$,style:"contenido"},{text:"",style:"tableHeader",alignment:"right"}],[{text:"Correo: "+G,style:"contenido"},{text:"",style:"contenido",alignment:"right"}],[{text:"Telefono: "+j,style:"contenido"},{}]]},layout:"noBorders"},{text:"Resumen del pedido:",style:"subtitulo"},(_=q,f=["num_orden","detalle","precio","cantidad","total"],b=function(){var f,b,_=0,Z=0,A=0;if(e.list_monturas.length>0)for(var s=0;s<e.list_monturas.length;s++)A+=f=e.list_monturas[s].precio_montura_v*e.list_monturas[s].cant_vendida,q.push({num_orden:_+=1,detalle:e.list_monturas[s].marca,precio:e.list_monturas[s].precio_montura_v,cantidad:e.list_monturas[s].cant_vendida,total:f});if(e.list_lunas.length>0)for(s=0;s<e.list_lunas.length;s++)A+=b=e.list_lunas[s].precio_luna_v*e.list_lunas[s].cant_vendida,q.push({num_orden:_+=1,detalle:e.list_lunas[s].material,precio:e.list_lunas[s].precio_luna_v,cantidad:e.list_lunas[s].cant_vendida,total:b});if(e.list_accesorios.length>0)for(s=0;s<e.list_accesorios.length;s++)A+=Z=e.list_accesorios[s].precio_accesorio_v*e.list_accesorios[s].cant_vendida,q.push({num_orden:_+=1,detalle:e.list_accesorios[s].nombre_accesorio,precio:e.list_accesorios[s].precio_accesorio_v,cantidad:e.list_accesorios[s].cant_vendida,total:Z});return A}(),{style:"tableMargin",color:"#444",table:{widths:[25,"*",63,60,63],heights:[20,20,20,20],headerRows:1,body:function(_,f,b){var Z=[];Z.push([{text:"No.",style:"tableHeader",alignment:"center"},{text:"Detalle",style:"tableHeader",alignment:"center"},{text:"Precio",style:"tableHeader",alignment:"center"},{text:"Cantidad",style:"tableHeader",alignment:"center"},{text:"Total",style:"tableHeader",alignment:"center"}]),_.forEach(function(s){var J=[];f.forEach(function(et){J.push(s[et].toString())}),Z.push(J)});var A=(0,S.NM)(b,1);return Z.push([{text:"",border:[!1,!1,!1,!1],colSpan:2},{},{text:"Total:",style:"tableHeader",alignment:"right",colSpan:2},{},{text:"S/ "+A,style:"contenido",alignment:"right"}]),Z}(_,f,b)}}),{text:[,{text:"Fecha de Entrega: ",style:"textBold"},u,"   ",{text:"Hora: ",style:"textBold"},v]},{text:"Nota:",style:"subtitulo2"},{text:"Todo trabajo se efectuara con un adelanto del 50%.",style:"contenido2",alignment:"justify"},{text:"La empresa no se responsabiliza de los pedidos no recogidos despu\xe9s de un mes.",style:"contenido2",alignment:"justify"}],styles:{subtitulo:{bold:!0,fontSize:13,color:"black",margin:[0,10,0,5]},subtitulo2:{bold:!0,fontSize:10,color:"black",margin:[0,10,0,5]},contenido:{fontSize:12},contenido2:{fontSize:8},textBold:{fontSize:12,bold:!0},header:{fontSize:17,bold:!0,margin:[0,0,0,10]},subheader:{fontSize:13,bold:!0,margin:[0,10,0,5]},subtitle:{fontSize:12,bold:!0,margin:[0,10,0,5]},tableMargin:{margin:[0,15,0,15]},tableOpacityExample:{margin:[0,5,0,15],fillColor:"blue",fillOpacity:.3},tableHeader:{bold:!0,fontSize:13,color:"black"}}};var _,f,b;E().createPdf(tt).open()})}fS(e){return this.formSedes.get(e)}changeSedes(){this.idSede=this.fS(this.nombre_sedes).value,this.getListVentas(this.idSede)}getListVentas(e){this.ventasService.getVentasbySede(e).subscribe(o=>{this.service.updateTable(o)})}exportarVentas(){if(this.formSedes.valid){let e=[];const o="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8";this.ventaService.getVentasbySede(this.idSede).subscribe(r=>{this.excelVentas=r,e=this.excelVentas.map(h=>({FECHA:new Date(h.fecha_creacion_venta).toLocaleDateString("en-GB"),"NOMBRE CLIENTE":h.nombre_cliente,TOTAL:h.tipo_venta[0].precio_total,VENDEDOR:h.nombre_vendedor,"FORMA DE PAGO":h.tipo_venta[0].forma_pago,ESTADO:h.tipo_venta[0].deuda>0?"DEUDA":"PAGADO"}));const u={Sheets:{hoja:L.P6.json_to_sheet(e)},SheetNames:["hoja"]},v=L.cW(u,{bookType:"xlsx",type:"array"}),C=new Blob([v],{type:o}),P=this.listSedes.find(h=>h.id_sede==this.fS(this.nombre_sedes).value);(0,pt.Z)(C,"ventas_"+P.nombre_sede)})}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(_t),t.Y36(d.qu),t.Y36(V),t.Y36(m.FF),t.Y36(ut.$),t.Y36(z.i),t.Y36(V))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-list-sales"]],viewQuery:function(e,o){if(1&e&&t.Gf(fe,5),2&e){let a;t.iGM(a=t.CRH())&&(o.headers=a)}},features:[t._Bn([_t,g.JJ])],decls:65,vars:22,consts:[[1,"container-fluid"],["title","Ventas",3,"breadcrumbItems"],[1,"row"],[1,"col-md-6","mb-2"],[1,"form-inline"],[1,"search-box","ml-2"],[1,"position-relative"],["type","text","placeholder","Buscar venta","name","searchTerm","aria-controls","tickets-table",1,"form-control","border-light","rounded",3,"ngModel","ngModelChange"],[1,"uil","uil-search","search-icon"],["role","toolbar",1,"btn-toolbar"],["class","col-12 col-md-6 d-grid mb-2 chat-search-box px-1",4,"appRole"],["class","col-12 col-md-6 d-grid",4,"appRole"],[1,"row","md-2"],["class","col-md-6 d-grid mb-2 chat-search-box px-1",4,"appRole"],[1,"col-md-6"],[1,"dataTables_length","text-md-end"],[1,"d-inline-flex","align-items-center"],["name","pageSize",1,"custom-select","custom-select-sm","form-control","form-control-sm","form-select","form-select-sm",3,"ngModel","ngModelChange"],[3,"ngValue"],[1,"col-12"],[1,"table-responsive","mb-4"],[1,"table","datatables","table-centered","table-nowrap","mb-0","align-middle","table-card-list",2,"border-spacing","0 12px","width","100%"],[1,"bg-transparent"],["scope","col","sortable","orden",3,"sort"],["scope","col","sortable","fecha_creacion_venta",3,"sort"],["scope","col","sortable","nombre_cliente",3,"sort"],["scope","col","sortable","",3,"sort"],["scope","col","sortable","nombre_vendedor",3,"sort"],[2,"width","170px"],["class","odd",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[1,"row","justify-content-md-between","align-items-md-center"],[1,"text-md-end","float-md-end","pagination-rounded"],[3,"collectionSize","page","pageSize","maxSize","rotate","boundaryLinks","pageChange"],["centerDataModalActualizarVenta",""],[1,"col-12","col-md-6","d-grid","mb-2","chat-search-box","px-1"],[3,"formGroup"],["ngbDropdown",""],["placeholder","Seleccione la sede","bindValue","id_sede","bindLabel","nombre_sede",3,"items","formControlName","change"],[1,"col-12","col-md-6","d-grid"],[1,"btn-group","mb-2"],["type","button","value","Descargar Archivo",1,"btn","btn-primary","btn-block",3,"click"],[1,"col-md-6","d-grid","mb-2","chat-search-box","px-1"],[1,"input-daterange","input-group"],["type","date","id","billing-fechanacimiento","placeholder","Seleccione la fecha",1,"form-control",3,"formControlName"],["type","button",1,"btn","btn-primary",3,"click"],[1,"mdi","mdi-filter-variant"],[1,"odd"],[3,"result","term"],[1,"avatar-xs","d-inline-block","me-2"],[1,"avatar-title","rounded-circle","bg-light","text-body"],[4,"ngIf"],[1,"btn","btn-light","btn-sm","w-xs",3,"click"],[1,"uil","uil-download-alt","ms-2"],["class","px-3 text-primary","placement","top","ngbTooltip","Editar",3,"click",4,"ngIf"],["class","px-3 text-danger","placement","top","ngbTooltip","Eliminar",3,"click",4,"appRole"],[1,"text-danger"],[1,"badge","rounded-pill","bg-soft-success","font-size-12",3,"ngClass"],[1,"text-success"],["placement","top","ngbTooltip","Editar",1,"px-3","text-primary",3,"click"],[1,"uil","uil-pen","font-size-18"],["placement","top","ngbTooltip","Eliminar",1,"px-3","text-danger",3,"click"],["class","uil uil-trash-alt font-size-18",4,"appRole"],[1,"uil","uil-trash-alt","font-size-18"],[1,"text-center","my-3"],["href","javascript:void(0);",1,"text-primary"],[1,"mdi","mdi-loading","mdi-spin","font-size-20","align-middle","me-2"],[1,"modal-header"],["id","modal-title",1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body","p-4"],[1,"col-lg-14"],[1,"col-sm-6"],[1,"mb-3"],[1,"control-label"],[1,"text-muted","text-sm-end"],[1,"mt-4"],[1,"text-danger","font-size-16"],[1,"badge","rounded-pill","bg-soft-success","font-size-16",3,"ngClass"],[1,"border-top","pt-4"],[1,"col-4"],["placeholder","Cantidad en soles","type","text","name","nameCantidadRecibidaCredito",1,"form-control",3,"formControlName","change"],["class","text-danger",4,"ngIf"],[1,"form-label"],["name","selectMetodo","placeholder","Seleccione",3,"items","formControlName"],["placeholder","Seleccione la fecha","type","text","name","nameFechaRegistroCredito",1,"form-control",3,"formControlName","ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"col-sm-12"],[1,"table-responsive"],[1,"table","table-sm","m-0","table-centered"],[2,"width","77px"],[4,"ngFor","ngForOf"],[1,"control-label",2,"text-align","left"],["placeholder","S/ 000.00","type","text","name","nameTotalCredito",1,"form-control",3,"formControlName","ngClass"],["placeholder","S/ 000.00","type","text","name","namePagoCredito",1,"form-control",3,"formControlName","ngClass"],["placeholder","S/ 000.00","type","text","name","nameCambioCredito",1,"form-control",3,"formControlName","ngClass"],[1,"col-lg-12"],[1,"mb-4"],["for","billing-observaciones",1,"form-label"],["id","billing-observaciones","rows","3","placeholder","Ingrese las observaciones",1,"form-control",3,"formControlName"],[1,"text-end","mt-2"],["type","button",1,"btn","btn-danger",3,"click"],["type","submit","id","btn-save-event",1,"btn","btn-success","ms-1",3,"disabled","click"],[1,"invalid-feedback"],["scope","row"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-page-title",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"div",4),t.TgZ(5,"div",5),t.TgZ(6,"div",6),t.TgZ(7,"input",7),t.NdJ("ngModelChange",function(r){return o.service.searchTerm=r}),t.qZA(),t._UZ(8,"i",8),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",3),t.TgZ(10,"div"),t.TgZ(11,"div",9),t.YNc(12,Ce,4,3,"div",10),t.YNc(13,Ae,3,0,"div",11),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(14,"div",12),t.YNc(15,Te,8,3,"div",13),t.TgZ(16,"div",14),t.TgZ(17,"div",15),t.TgZ(18,"label",16),t._uU(19,"Mostrar"),t.TgZ(20,"select",17),t.NdJ("ngModelChange",function(r){return o.service.pageSize=r}),t.TgZ(21,"option",18),t._uU(22,"10"),t.qZA(),t.TgZ(23,"option",18),t._uU(24,"25"),t.qZA(),t.TgZ(25,"option",18),t._uU(26,"50"),t.qZA(),t.TgZ(27,"option",18),t._uU(28,"100"),t.qZA(),t.qZA(),t._uU(29," entradas"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(30,"div",2),t.TgZ(31,"div",19),t.TgZ(32,"div"),t.TgZ(33,"div",20),t.TgZ(34,"form"),t.TgZ(35,"table",21),t.TgZ(36,"thead"),t.TgZ(37,"tr",22),t.TgZ(38,"th",23),t.NdJ("sort",function(r){return o.onSort(r)}),t._uU(39,"Ord."),t.qZA(),t.TgZ(40,"th",24),t.NdJ("sort",function(r){return o.onSort(r)}),t._uU(41,"Fecha"),t.qZA(),t.TgZ(42,"th",25),t.NdJ("sort",function(r){return o.onSort(r)}),t._uU(43,"Nombre del Cliente"),t.qZA(),t.TgZ(44,"th",26),t.NdJ("sort",function(r){return o.onSort(r)}),t._uU(45,"Total"),t.qZA(),t.TgZ(46,"th",27),t.NdJ("sort",function(r){return o.onSort(r)}),t._uU(47,"Vendedor"),t.qZA(),t.TgZ(48,"th",26),t.NdJ("sort",function(r){return o.onSort(r)}),t._uU(49,"Estado de Pago"),t.qZA(),t.TgZ(50,"th",26),t.NdJ("sort",function(r){return o.onSort(r)}),t._uU(51,"Descargar Pdf"),t.qZA(),t.TgZ(52,"th",28),t._uU(53,"Acci\xf3n"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(54,"tbody"),t.YNc(55,Ue,26,21,"tr",29),t.ALo(56,"async"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(57,Pe,6,0,"div",30),t.TgZ(58,"div",31),t.TgZ(59,"div",19),t.TgZ(60,"div",32),t.TgZ(61,"ngb-pagination",33),t.NdJ("pageChange",function(r){return o.service.page=r}),t.ALo(62,"async"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(63,Fe,94,35,"ng-template",null,34,t.W1O),t.qZA()),2&e&&(t.xp6(1),t.Q6J("breadcrumbItems",o.breadCrumbItems),t.xp6(6),t.Q6J("ngModel",o.service.searchTerm),t.xp6(5),t.Q6J("appRole",o.role),t.xp6(1),t.Q6J("appRole",o.role),t.xp6(2),t.Q6J("appRole",o.role),t.xp6(5),t.Q6J("ngModel",o.service.pageSize),t.xp6(1),t.Q6J("ngValue",10),t.xp6(2),t.Q6J("ngValue",25),t.xp6(2),t.Q6J("ngValue",50),t.xp6(2),t.Q6J("ngValue",100),t.xp6(28),t.Q6J("ngForOf",t.lcZ(56,18,o.transactions$)),t.xp6(2),t.Q6J("ngIf",!o.mostrarSpinner),t.xp6(4),t.Q6J("collectionSize",t.lcZ(62,20,o.total$))("page",o.service.page)("pageSize",o.service.pageSize)("maxSize",5)("rotate",!0)("boundaryLinks",!0))},directives:[H.V,d.Fj,d.JJ,d.On,R.g,d.EJ,d.YN,d.Kr,d._Y,d.JL,d.F,g.sg,g.O5,m.N9,d.sg,m.jt,w.w9,d.u,m._h,g.mk,m._L],pipes:[g.Ov,g.uU,g.H9],styles:[""]}),i})(),data:{role:["Vendedor","Admin"]},canActivate:[F.a]},{path:"deletesales",component:(()=>{class i{constructor(e,o,a){this.fb=e,this.usuarioService=o,this.ventaService=a,this.role="Admin",this.nombre_sedes="campoSede",this.idSede=""}ngOnInit(){this.breadCrumbItems=[{label:"Ventas"},{label:"Ventas Eliminas",active:!0}],this.getListSedes(),this.crearFormulario()}getListSedes(){this.listSedes=JSON.parse(localStorage.getItem("sedes")),this.idSede=this.usuarioService.getSedebyUser()}crearFormulario(){this.formSedes=this.fb.group({[this.nombre_sedes]:[this.idSede,[d.kI.required]]})}fS(e){return this.formSedes.get(e)}exportarVentasEliminadas(){if(this.formSedes.valid){let e=[];const o="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8";this.ventaService.getVentasEliminadasbySede(this.fS(this.nombre_sedes).value).subscribe(r=>{if(r.length>0){e=r.map(h=>({FECHA:new Date(h.fecha_creacion_venta).toLocaleDateString("en-GB"),"NOMBRE CLIENTE":h.nombre_cliente,TOTAL:h.tipo_venta[0].precio_total,VENDEDOR:h.nombre_vendedor,"FORMA DE PAGO":h.tipo_venta[0].forma_pago}));const u={Sheets:{hoja:L.P6.json_to_sheet(e)},SheetNames:["hoja"]},v=L.cW(u,{bookType:"xlsx",type:"array"}),C=new Blob([v],{type:o}),P=this.listSedes.find(h=>h.id_sede==this.fS(this.nombre_sedes).value);(0,pt.Z)(C,"ventas_eliminadas_"+P.nombre_sede)}else this.mostrarMensaje()})}}mostrarMensaje(){T().fire({title:"B\xfasqueda finalizada",text:"No existen ventas elimindas",icon:"error",confirmButtonColor:"#34c38f"})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(d.qu),t.Y36(z.i),t.Y36(V))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-deleted-sales"]],decls:21,vars:2,consts:[[1,"container-fluid"],["title","Ventas Eliminadas",3,"breadcrumbItems"],[1,"row"],[1,"col-lg-6"],[1,"card"],[1,"card-body"],[1,"card-title-desc","text-danger"],[1,"col-12","col-sm-12"],[1,"mb-3"],["for","validationCustom01"],["role","toolbar",1,"btn-toolbar"],["class","col-12 d-grid",4,"appRole"],[1,"row","my-2"],[1,"col"],[1,"text-sm-end","mt-2","mt-sm-0"],[1,"btn","btn-success",3,"click"],[1,"uil","uil-store-alt","me-1"],[1,"col-12","d-grid"],[3,"formGroup"],["ngbDropdown",""],["placeholder","Seleccione la sede","bindValue","id_sede","bindLabel","nombre_sede",3,"items","formControlName"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-page-title",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"div",4),t.TgZ(5,"div",5),t.TgZ(6,"p",6),t._uU(7,"* Campo requerido"),t.qZA(),t.TgZ(8,"div",2),t.TgZ(9,"div",7),t.TgZ(10,"div",8),t.TgZ(11,"label",9),t._uU(12,"Sede *"),t.qZA(),t.TgZ(13,"div",10),t.YNc(14,Qe,4,3,"div",11),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(15,"div",12),t.TgZ(16,"div",13),t.TgZ(17,"div",14),t.TgZ(18,"button",15),t.NdJ("click",function(){return o.exportarVentasEliminadas()}),t._UZ(19,"i",16),t._uU(20," Descargar Archivo "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("breadcrumbItems",o.breadCrumbItems),t.xp6(13),t.Q6J("appRole",o.role))},directives:[H.V,R.g,d._Y,d.JL,d.sg,m.jt,w.w9,d.JJ,d.u],styles:[""]}),i})(),data:{role:["Vendedor","Admin"]},canActivate:[F.a]}];let Re=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[at.Bz.forChild(He)],at.Bz]}),i})();var Oe=l(2974);let Be=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[{provide:it._t,useValue:ft.v}],imports:[[Re,g.ez,d.UX,d.u5,Zt.h,m.XC,it.Ti,bt.v,ot.bt,w.A0,m.jF,m.HK,m.Gs,m.ZS,m.lQ,m.Oz,m.IJ,mt.rP,m.IJ,Oe.o]]}),i})()}}]);